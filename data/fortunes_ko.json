# generate_fortunes_db.py
import os, json
from datetime import datetime

BASE_DIR = os.path.dirname(os.path.abspath(__file__))
DATA_DIR = os.path.join(BASE_DIR, "data")
os.makedirs(DATA_DIR, exist_ok=True)

def make_pool(kind: str, n: int):
    openings = {
        "today": ["오늘은", "오늘은 특히", "오늘 하루는", "오늘의 핵심은", "오늘 운세는"],
        "tomorrow": ["내일은", "내일은 특히", "내일 하루는", "내일의 포인트는", "내일 운세는"],
        "year_all": ["2026년은", "올해(2026)는", "2026 전체 흐름은", "2026년 전반은", "2026년의 키워드는"],
        "advice": ["조언:", "팁:", "한 줄 조언:", "오늘의 액션팁:", "실행 포인트:"]
    }[kind]

    themes = ["연애", "재물", "일/학업", "건강", "인간관계", "기회", "집중", "정리", "선택", "속도", "휴식", "행운"]
    verbs = ["잡아보세요", "조심하세요", "확인하세요", "정리해보세요", "기록해두세요", "한 번 더 해보세요", "천천히 가세요", "과감히 결정하세요"]
    details = [
        "작은 약속이 큰 신뢰로 이어집니다.",
        "충동보다 계획이 이득을 만듭니다.",
        "대화 한 번이 흐름을 바꿉니다.",
        "지금은 '줄이기'가 곧 '늘리기'입니다.",
        "컨디션이 곧 운입니다. 수면을 챙기세요.",
        "오늘은 선택을 좁히면 길이 보입니다.",
        "메모해둔 아이디어가 성과로 연결됩니다.",
        "미뤄둔 일 하나만 끝내도 운이 트입니다.",
        "기회는 조용히 옵니다. 놓치지 마세요.",
        "가벼운 운동이 집중력을 끌어올립니다.",
        "타인의 말보다 데이터/증거를 보세요.",
        "감정은 잠깐, 결과는 길게 남습니다."
    ]

    pool = []
    for i in range(n):
        th = themes[i % len(themes)]
        op = openings[i % len(openings)]
        det = details[i % len(details)]
        vb = verbs[i % len(verbs)]

        if kind == "advice":
            line = f"{op} {th}에서 {det} 오늘은 우선순위를 1개로 줄이고 {vb}"
        elif kind == "year_all":
            line = f"{op} {th} 운이 강해지는 시기입니다. {det} 큰 결정보다 '꾸준한 루틴'이 승부를 냅니다."
        else:
            line = f"{op} {th}의 흐름이 중요합니다. {det} 무리한 확장보다 한 단계씩 {vb}"

        pool.append(line)
    return pool

def main():
    db = {
        "meta": {
            "version": "2026.01",
            "generated_at": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
            "notes": "All fortune texts are served ONLY from this DB. No combo keys."
        },
        "pools": {
            # 숫자는 원하면 더 키워도 됩니다 (예: 500, 1000)
            "today": make_pool("today", 480),
            "tomorrow": make_pool("tomorrow", 480),
            "year_all": make_pool("year_all", 480),
            "advice": make_pool("advice", 480),
        }
    }

    out_path = os.path.join(DATA_DIR, "fortunes_ko.json")
    with open(out_path, "w", encoding="utf-8") as f:
        json.dump(db, f, ensure_ascii=False, indent=2)

    print("OK:", out_path)

if __name__ == "__main__":
    main()
