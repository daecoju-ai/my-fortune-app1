import streamlit as st
from datetime import datetime, timedelta
import random
import time
import re
import json

# ---- (ì„ íƒ) êµ¬ê¸€ì‹œíŠ¸ ì‚¬ìš© ----
# requirements.txt: streamlit, gspread, google-auth
try:
    import gspread
    from google.oauth2.service_account import Credentials
except Exception:
    gspread = None
    Credentials = None


# =========================================================
# 0) ê¸°ë³¸ ì„¤ì •
# =========================================================
APP_URL = "https://my-fortune.streamlit.app"
SPREADSHEET_ID = "1WvuKXx2if2WvxmQaxkqzFW-BzDEWWma9hZgCr2jJQYY"  # ê³ ì •
SHEET_NAME = "ì‹œíŠ¸1"  # ê³ ì •(ì‚¬ìš©ì ìš”ì²­)

st.set_page_config(
    page_title="2026 Fortune | ë +MBTI+ì‚¬ì£¼+ì˜¤ëŠ˜/ë‚´ì¼",
    page_icon="ğŸ”®",
    layout="centered"
)

# =========================================================
# 1) SEO / ê²€ìƒ‰ ë…¸ì¶œìš© ë©”íƒ€ íƒœê·¸ (êµ¬ê¸€/ë„¤ì´ë²„/AIê²€ìƒ‰)
#   - Streamlitì€ head ì§ì ‘ ì œì–´ê°€ ì œí•œì ì´ë¼ JSë¡œ headì— ì‚½ì…
# =========================================================
def inject_seo(lang_code: str):
    desc_map = {
        "ko": "2026ë…„ ë ìš´ì„¸ + MBTI + ì‚¬ì£¼ + ì˜¤ëŠ˜/ë‚´ì¼ ìš´ì„¸ë¥¼ í•œ ë²ˆì—! ë¬´ë£Œ ìš´ì„¸ ì„œë¹„ìŠ¤. ë¯¸ë‹ˆê²Œì„ ì´ë²¤íŠ¸(í•œêµ­ì–´).",
        "en": "Free 2026 Zodiac + MBTI + Saju + Daily/Tomorrow fortune. Mini game event (Korean only).",
        "ja": "2026å¹´ã®å¹²æ”¯é‹å‹¢ï¼‹MBTIï¼‹å››æŸ±ï¼‹ä»Šæ—¥/æ˜æ—¥ã®é‹å‹¢ã€‚ç„¡æ–™ã‚µãƒ¼ãƒ“ã‚¹ã€‚",
        "zh": "å…è´¹æŸ¥çœ‹2026ç”Ÿè‚–è¿åŠ¿ + MBTI + å››æŸ± + ä»Šæ—¥/æ˜æ—¥è¿åŠ¿ã€‚",
        "ru": "Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾: 2026 Ğ·Ğ¾Ğ´Ğ¸Ğ°Ğº + MBTI + Ğ¡Ğ°Ğ´Ğ¶Ñƒ + ÑƒĞ´Ğ°Ñ‡Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ/Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°.",
        "hi": "à¤®à¥à¤«à¤¼à¥à¤¤ 2026 à¤°à¤¾à¤¶à¤¿ + MBTI + à¤¸à¤¾à¤œà¥‚ + à¤†à¤œ/à¤•à¤² à¤•à¥€ à¤•à¤¿à¤¸à¥à¤®à¤¤à¥¤"
    }
    description = desc_map.get(lang_code, desc_map["en"])

    keywords_map = {
        "ko": "2026 ìš´ì„¸, ë ìš´ì„¸, MBTI ìš´ì„¸, ì‚¬ì£¼, ì˜¤ëŠ˜ ìš´ì„¸, ë‚´ì¼ ìš´ì„¸, ë¬´ë£Œ ìš´ì„¸, íƒ€ë¡œ",
        "en": "2026 fortune, zodiac, MBTI, saju, today fortune, tomorrow fortune, free, tarot",
        "ja": "2026 é‹å‹¢, å¹²æ”¯, MBTI, å››æŸ±, ä»Šæ—¥ã®é‹å‹¢, æ˜æ—¥ã®é‹å‹¢, ç„¡æ–™, ã‚¿ãƒ­ãƒƒãƒˆ",
        "zh": "2026 è¿åŠ¿, ç”Ÿè‚–, MBTI, å››æŸ±, ä»Šæ—¥è¿åŠ¿, æ˜æ—¥è¿åŠ¿, å…è´¹, å¡”ç½—",
        "ru": "2026 Ğ³Ğ¾Ñ€Ğ¾ÑĞºĞ¾Ğ¿, Ğ·Ğ¾Ğ´Ğ¸Ğ°Ğº, MBTI, ÑĞ°Ğ´Ğ¶Ñƒ, ÑƒĞ´Ğ°Ñ‡Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ, Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾, Ñ‚Ğ°Ñ€Ğ¾",
        "hi": "2026 à¤°à¤¾à¤¶à¤¿à¤«à¤², à¤°à¤¾à¤¶à¤¿, MBTI, à¤†à¤œ à¤•à¤¾ à¤°à¤¾à¤¶à¤¿à¤«à¤², à¤•à¤² à¤•à¤¾ à¤°à¤¾à¤¶à¤¿à¤«à¤², à¤®à¥à¤«à¥à¤¤, à¤Ÿà¥ˆà¤°à¥‹"
    }
    keywords = keywords_map.get(lang_code, keywords_map["en"])

    title = "2026 Fortune | Zodiac + MBTI + Saju + Today/Tomorrow"
    if lang_code == "ko":
        title = "2026 ìš´ì„¸ | ë  + MBTI + ì‚¬ì£¼ + ì˜¤ëŠ˜/ë‚´ì¼ ìš´ì„¸"

    json_ld_obj = {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": title,
        "url": APP_URL,
        "applicationCategory": "LifestyleApplication",
        "operatingSystem": "Web",
        "description": description
    }
    json_ld_str = json.dumps(json_ld_obj, ensure_ascii=False)

    st.components.v1.html(
        f"""
<script>
(function() {{
  try {{
    const meta = [
      ['name','description', {json.dumps(description, ensure_ascii=False)}],
      ['name','keywords', {json.dumps(keywords, ensure_ascii=False)}],
      ['property','og:title', {json.dumps(title, ensure_ascii=False)}],
      ['property','og:description', {json.dumps(description, ensure_ascii=False)}],
      ['property','og:type','website'],
      ['property','og:url', {json.dumps(APP_URL)}],
      ['name','twitter:card','summary'],
      ['name','robots','index,follow']
    ];

    meta.forEach(([attr, key, val]) => {{
      let el = document.head.querySelector(`meta[${{attr}}="${{key}}"]`);
      if(!el) {{
        el = document.createElement('meta');
        el.setAttribute(attr, key);
        document.head.appendChild(el);
      }}
      el.setAttribute('content', val);
    }});

    let canonical = document.head.querySelector('link[rel="canonical"]');
    if(!canonical) {{
      canonical = document.createElement('link');
      canonical.setAttribute('rel','canonical');
      document.head.appendChild(canonical);
    }}
    canonical.setAttribute('href', {json.dumps(APP_URL)});

    let script = document.head.querySelector('script[data-jsonld="fortune"]');
    if(!script) {{
      script = document.createElement('script');
      script.type = 'application/ld+json';
      script.setAttribute('data-jsonld','fortune');
      document.head.appendChild(script);
    }}
    script.text = {json.dumps(json_ld_str)};
  }} catch(e) {{}}
}})();
</script>
""",
        height=0
    )

# =========================================================
# 2) ë‹¤êµ­ì–´ í…ìŠ¤íŠ¸ (6ê°œ ì–¸ì–´)
# =========================================================
LANGS = [
    ("ko", "í•œêµ­ì–´"),
    ("en", "English"),
    ("ja", "æ—¥æœ¬èª"),
    ("zh", "ä¸­æ–‡"),
    ("ru", "Ğ ÑƒÑÑĞºĞ¸Ğ¹"),
    ("hi", "à¤¹à¤¿à¤¨à¥à¤¦à¥€"),
]

T = {
    "ko": {
        "lang_pick": "ì–¸ì–´ ì„ íƒ",
        "title": "2026 ë  + MBTI + ì‚¬ì£¼ + ì˜¤ëŠ˜/ë‚´ì¼ ìš´ì„¸",
        "subtitle": "ì™„ì „ ë¬´ë£Œ",
        "name": "ì´ë¦„ ì…ë ¥ (ê²°ê³¼ì— í‘œì‹œë¼ìš”)",
        "birth": "ìƒë…„ì›”ì¼ ì…ë ¥",
        "year": "ë…„",
        "month": "ì›”",
        "day": "ì¼",
        "mbti_mode": "MBTIë¥¼ ì–´ë–»ê²Œ í• ê¹Œìš”?",
        "mbti_direct": "ì§ì ‘ ì„ íƒ",
        "mbti_12": "ê°„ë‹¨ í…ŒìŠ¤íŠ¸ (12ë¬¸í•­)",
        "mbti_16": "ìƒì„¸ í…ŒìŠ¤íŠ¸ (16ë¬¸í•­)",
        "go_result": "2026ë…„ ìš´ì„¸ ë³´ê¸°!",
        "reset": "ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°",
        "share_btn": "ì¹œêµ¬ì—ê²Œ ê²°ê³¼ ê³µìœ í•˜ê¸°",
        "share_hint": "ëª¨ë°”ì¼ì€ ê³µìœ (ì¹´í†¡/ë©”ì‹œì§€ ë“±) í™”ë©´ì´ ëœ¨ê³ , PCëŠ” ë³µì‚¬ë©ë‹ˆë‹¤.",
        "tarot_btn": "ì˜¤ëŠ˜ì˜ íƒ€ë¡œ ì¹´ë“œ ë½‘ê¸°",
        "tarot_title": "ì˜¤ëŠ˜ì˜ íƒ€ë¡œ ì¹´ë“œ",
        "best_combo": "ìµœê³  ì¡°í•©!",
        "sections": {
            "zodiac": "ë  ìš´ì„¸",
            "mbti": "MBTI íŠ¹ì§•",
            "saju": "ì‚¬ì£¼ í•œ ë§ˆë””",
            "today": "ì˜¤ëŠ˜ ìš´ì„¸",
            "tomorrow": "ë‚´ì¼ ìš´ì„¸",
            "year_all": "2026 ì „ì²´ ìš´ì„¸",
            "love": "ì—°ì• ìš´",
            "money": "ì¬ë¬¼ìš´",
            "work": "ì¼/í•™ì—…ìš´",
            "health": "ê±´ê°•ìš´",
            "point": "í–‰ìš´ í¬ì¸íŠ¸",
            "advice": "ì¡°í•© ì¡°ì–¸",
        },
        "ad_kr_title": "ì •ìˆ˜ê¸°ë Œíƒˆ ëŒ€ë°•!",
        "ad_kr_body1": "ì œíœ´ì¹´ë“œë©´ ì›” 0ì›ë¶€í„°!",
        "ad_kr_body2": "ì„¤ì¹˜ ë‹¹ì¼ ìµœëŒ€ 50ë§Œì› ì§€ì› + ì‚¬ì€í’ˆ ë“¬ë¿",
        "ad_kr_link": "ë‹¤ë‚˜ëˆ”ë Œíƒˆ.com ë°”ë¡œê°€ê¸°",
        "ad_kr_url": "https://www.ë‹¤ë‚˜ëˆ”ë Œíƒˆ.com",
        "ad_placeholder": "AD (ì‹¬ì‚¬ í†µê³¼ í›„ ì´ ìœ„ì¹˜ì— ê´‘ê³ ê°€ í‘œì‹œë©ë‹ˆë‹¤)",
        "mini_title": "ğŸ ë¯¸ë‹ˆê²Œì„: ì„ ì°©ìˆœ 20ëª… ì»¤í”¼ì¿ í° ë„ì „!",
        "mini_desc": "ìŠ¤í†±ì›Œì¹˜ë¥¼ **20.16ì´ˆ**ì— ë”± ë§ì¶”ë©´ ë‹¹ì²¨!\n\n- ê¸°ë³¸ 1íšŒ\n- **ì¹œêµ¬ì—ê²Œ ê²°ê³¼ ê³µìœ í•˜ê¸°** ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ 1íšŒ ì¶”ê°€\n- ëª©í‘œ êµ¬ê°„: **20.160 ~ 20.169ì´ˆ**",
        "mini_start": "ê²Œì„ ì‹œì‘",
        "mini_stop": "ì •ì§€",
        "mini_try_left": "ë‚¨ì€ ì‹œë„",
        "mini_closed": "ì´ë²¤íŠ¸ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (ì„ ì°©ìˆœ 20ëª… ë§ˆê°)",
        "mini_dup": "ì´ë¯¸ ì°¸ì—¬í•œ ë²ˆí˜¸ì…ë‹ˆë‹¤. (ì¤‘ë³µ ì°¸ì—¬ ë¶ˆê°€)",
        "mini_need_start": "ë¨¼ì € 'ê²Œì„ ì‹œì‘'ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.",
        "mini_result": "ê¸°ë¡",
        "win_title": "ğŸ‰ ë‹¹ì²¨! ì •ë³´ ì…ë ¥",
        "win_name": "ì´ë¦„",
        "win_phone": "ì „í™”ë²ˆí˜¸",
        "win_consent": "ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜(í•„ìˆ˜)",
        "win_consent_text": "ì´ë²¤íŠ¸ ê²½í’ˆ ë°œì†¡ì„ ìœ„í•´ ì´ë¦„/ì „í™”ë²ˆí˜¸ë¥¼ ìˆ˜ì§‘í•˜ë©°, ëª©ì  ë‹¬ì„± í›„ ì§€ì²´ ì—†ì´ íŒŒê¸°í•©ë‹ˆë‹¤. ë™ì˜ ê±°ë¶€ ì‹œ ì°¸ì—¬ê°€ ì œí•œë©ë‹ˆë‹¤.",
        "win_submit": "ì œì¶œ",
        "win_thanks": "ì ‘ìˆ˜ ì™„ë£Œ! ì»¤í”¼ì¿ í° ë°œì†¡ ëŒ€ìƒì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.",
        "sheet_fail": "êµ¬ê¸€ì‹œíŠ¸ ì—°ê²°ì´ ì•„ì§ ì•ˆ ë˜ì–´ ìˆì–´ìš”. (Secrets/requirements/ì‹œíŠ¸ ê³µìœ /íƒ­ ì´ë¦„ í™•ì¸ í•„ìš”)",
        "sheet_ok": "êµ¬ê¸€ì‹œíŠ¸ ì—°ê²° ì™„ë£Œ",
        "mbti_submit": "ì œì¶œí•˜ë©´ ê²°ê³¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.",
    },
    "en": {
        "lang_pick": "Language",
        "title": "2026 Zodiac + MBTI + Saju + Today/Tomorrow",
        "subtitle": "Completely Free",
        "name": "Name (shown in result)",
        "birth": "Birth date",
        "year": "Year",
        "month": "Month",
        "day": "Day",
        "mbti_mode": "How do you want to set MBTI?",
        "mbti_direct": "Pick directly",
        "mbti_12": "Quick test (12)",
        "mbti_16": "Full test (16)",
        "go_result": "See 2026 Fortune!",
        "reset": "Start over",
        "share_btn": "Share result",
        "share_hint": "On mobile it opens share sheet. On PC it copies.",
        "tarot_btn": "Draw today's tarot card",
        "tarot_title": "Today's Tarot",
        "best_combo": "Best combo!",
        "sections": {
            "zodiac": "Zodiac",
            "mbti": "MBTI",
            "saju": "Saju",
            "today": "Today",
            "tomorrow": "Tomorrow",
            "year_all": "2026 Overall",
            "love": "Love",
            "money": "Money",
            "work": "Work/Study",
            "health": "Health",
            "point": "Lucky point",
            "advice": "Combo advice",
        },
        "ad_placeholder": "AD (Ads will appear here after approval)",
        "mini_title": "",
        "mini_desc": "",
        "mini_start": "",
        "mini_stop": "",
        "mini_try_left": "",
        "mini_closed": "",
        "mini_dup": "",
        "mini_need_start": "",
        "mini_result": "",
        "win_title": "",
        "win_name": "",
        "win_phone": "",
        "win_consent": "",
        "win_consent_text": "",
        "win_submit": "",
        "win_thanks": "",
        "sheet_fail": "",
        "sheet_ok": "",
        "mbti_submit": "Submit to see result.",
    },
    "ja": {
        "lang_pick": "è¨€èª",
        "title": "2026å¹´ å¹²æ”¯ + MBTI + å››æŸ± + ä»Šæ—¥/æ˜æ—¥ã®é‹å‹¢",
        "subtitle": "å®Œå…¨ç„¡æ–™",
        "name": "åå‰ï¼ˆçµæœã«è¡¨ç¤ºï¼‰",
        "birth": "ç”Ÿå¹´æœˆæ—¥",
        "year": "å¹´",
        "month": "æœˆ",
        "day": "æ—¥",
        "mbti_mode": "MBTIã®è¨­å®šæ–¹æ³•",
        "mbti_direct": "ç›´æ¥é¸æŠ",
        "mbti_12": "ç°¡æ˜“ãƒ†ã‚¹ãƒˆï¼ˆ12å•ï¼‰",
        "mbti_16": "è©³ç´°ãƒ†ã‚¹ãƒˆï¼ˆ16å•ï¼‰",
        "go_result": "é‹å‹¢ã‚’è¦‹ã‚‹",
        "reset": "æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™",
        "share_btn": "çµæœã‚’å…±æœ‰",
        "share_hint": "ã‚¹ãƒãƒ›ã¯å…±æœ‰ç”»é¢ã€PCã¯ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚",
        "tarot_btn": "ä»Šæ—¥ã®ã‚¿ãƒ­ãƒƒãƒˆã‚’å¼•ã",
        "tarot_title": "ä»Šæ—¥ã®ã‚¿ãƒ­ãƒƒãƒˆ",
        "best_combo": "æœ€é«˜ã®çµ„ã¿åˆã‚ã›ï¼",
        "sections": {
            "zodiac": "å¹²æ”¯é‹å‹¢",
            "mbti": "MBTIç‰¹å¾´",
            "saju": "å››æŸ±ã‚³ãƒ¡ãƒ³ãƒˆ",
            "today": "ä»Šæ—¥",
            "tomorrow": "æ˜æ—¥",
            "year_all": "2026å¹´ç·åˆ",
            "love": "æ‹æ„›",
            "money": "é‡‘é‹",
            "work": "ä»•äº‹/å­¦æ¥­",
            "health": "å¥åº·",
            "point": "ãƒ©ãƒƒã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆ",
            "advice": "ã‚¢ãƒ‰ãƒã‚¤ã‚¹",
        },
        "ad_placeholder": "ADï¼ˆå¯©æŸ»é€šéå¾Œã“ã“ã«è¡¨ç¤ºï¼‰",
        "mini_title": "",
        "mini_desc": "",
        "mini_start": "",
        "mini_stop": "",
        "mini_try_left": "",
        "mini_closed": "",
        "mini_dup": "",
        "mini_need_start": "",
        "mini_result": "",
        "win_title": "",
        "win_name": "",
        "win_phone": "",
        "win_consent": "",
        "win_consent_text": "",
        "win_submit": "",
        "win_thanks": "",
        "sheet_fail": "",
        "sheet_ok": "",
        "mbti_submit": "é€ä¿¡ã™ã‚‹ã¨çµæœã¸ã€‚",
    },
    "zh": {
        "lang_pick": "è¯­è¨€",
        "title": "2026 ç”Ÿè‚– + MBTI + å››æŸ± + ä»Šæ—¥/æ˜æ—¥è¿åŠ¿",
        "subtitle": "å®Œå…¨å…è´¹",
        "name": "å§“åï¼ˆç»“æœæ˜¾ç¤ºï¼‰",
        "birth": "å‡ºç”Ÿæ—¥æœŸ",
        "year": "å¹´",
        "month": "æœˆ",
        "day": "æ—¥",
        "mbti_mode": "MBTI è®¾ç½®æ–¹å¼",
        "mbti_direct": "ç›´æ¥é€‰æ‹©",
        "mbti_12": "å¿«é€Ÿæµ‹è¯•ï¼ˆ12é¢˜ï¼‰",
        "mbti_16": "è¯¦ç»†æµ‹è¯•ï¼ˆ16é¢˜ï¼‰",
        "go_result": "æŸ¥çœ‹è¿åŠ¿",
        "reset": "é‡æ–°å¼€å§‹",
        "share_btn": "åˆ†äº«ç»“æœ",
        "share_hint": "æ‰‹æœºæ‰“å¼€åˆ†äº«é¢æ¿ï¼Œç”µè„‘å¤åˆ¶æ–‡æœ¬ã€‚",
        "tarot_btn": "æŠ½å–ä»Šæ—¥å¡”ç½—",
        "tarot_title": "ä»Šæ—¥å¡”ç½—",
        "best_combo": "æœ€ä½³ç»„åˆï¼",
        "sections": {
            "zodiac": "ç”Ÿè‚–è¿åŠ¿",
            "mbti": "MBTI ç‰¹ç‚¹",
            "saju": "å››æŸ±è¯„è¯­",
            "today": "ä»Šå¤©",
            "tomorrow": "æ˜å¤©",
            "year_all": "2026 æ€»è¿",
            "love": "æ‹çˆ±",
            "money": "è´¢è¿",
            "work": "å·¥ä½œ/å­¦ä¹ ",
            "health": "å¥åº·",
            "point": "å¹¸è¿ç‚¹",
            "advice": "å»ºè®®",
        },
        "ad_placeholder": "ADï¼ˆå®¡æ ¸é€šè¿‡åæ˜¾ç¤ºï¼‰",
        "mini_title": "",
        "mini_desc": "",
        "mini_start": "",
        "mini_stop": "",
        "mini_try_left": "",
        "mini_closed": "",
        "mini_dup": "",
        "mini_need_start": "",
        "mini_result": "",
        "win_title": "",
        "win_name": "",
        "win_phone": "",
        "win_consent": "",
        "win_consent_text": "",
        "win_submit": "",
        "win_thanks": "",
        "sheet_fail": "",
        "sheet_ok": "",
        "mbti_submit": "æäº¤åæŸ¥çœ‹ç»“æœã€‚",
    },
    "ru": {
        "lang_pick": "Ğ¯Ğ·Ñ‹Ğº",
        "title": "2026: Ğ—Ğ¾Ğ´Ğ¸Ğ°Ğº + MBTI + Ğ¡Ğ°Ğ´Ğ¶Ñƒ + Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ/Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ°",
        "subtitle": "ĞŸĞ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾",
        "name": "Ğ˜Ğ¼Ñ (Ğ² Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğµ)",
        "birth": "Ğ”Ğ°Ñ‚Ğ° Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ",
        "year": "Ğ“Ğ¾Ğ´",
        "month": "ĞœĞµÑÑÑ†",
        "day": "Ğ”ĞµĞ½ÑŒ",
        "mbti_mode": "ĞšĞ°Ğº ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ MBTI?",
        "mbti_direct": "Ğ’Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ",
        "mbti_12": "Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ñ‚ĞµÑÑ‚ (12)",
        "mbti_16": "ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ‚ĞµÑÑ‚ (16)",
        "go_result": "ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑƒĞ´Ğ°Ñ‡Ñƒ 2026",
        "reset": "Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ°",
        "share_btn": "ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒÑÑ",
        "share_hint": "ĞĞ° Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğµ Ğ¾Ñ‚ĞºÑ€Ğ¾ĞµÑ‚ÑÑ Ğ¼ĞµĞ½Ñ â€œĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒÑÑâ€, Ğ½Ğ° ĞŸĞš â€” ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ.",
        "tarot_btn": "Ğ’Ñ‹Ñ‚ÑĞ½ÑƒÑ‚ÑŒ Ñ‚Ğ°Ñ€Ğ¾ Ğ´Ğ½Ñ",
        "tarot_title": "Ğ¢Ğ°Ñ€Ğ¾ Ğ´Ğ½Ñ",
        "best_combo": "Ğ›ÑƒÑ‡ÑˆĞ°Ñ ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ!",
        "sections": {
            "zodiac": "Ğ—Ğ¾Ğ´Ğ¸Ğ°Ğº",
            "mbti": "MBTI",
            "saju": "Ğ¡Ğ°Ğ´Ğ¶Ñƒ",
            "today": "Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ",
            "tomorrow": "Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ°",
            "year_all": "Ğ˜Ñ‚Ğ¾Ğ³ 2026",
            "love": "Ğ›ÑĞ±Ğ¾Ğ²ÑŒ",
            "money": "Ğ”ĞµĞ½ÑŒĞ³Ğ¸",
            "work": "Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°/Ğ£Ñ‡Ñ‘Ğ±Ğ°",
            "health": "Ğ—Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ",
            "point": "Ğ¡Ñ‡Ğ°ÑÑ‚Ğ»Ğ¸Ğ²Ñ‹Ğ¹ Ğ¿ÑƒĞ½ĞºÑ‚",
            "advice": "Ğ¡Ğ¾Ğ²ĞµÑ‚",
        },
        "ad_placeholder": "AD (Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾Ğ´Ğ¾Ğ±Ñ€ĞµĞ½Ğ¸Ñ)",
        "mini_title": "",
        "mini_desc": "",
        "mini_start": "",
        "mini_stop": "",
        "mini_try_left": "",
        "mini_closed": "",
        "mini_dup": "",
        "mini_need_start": "",
        "mini_result": "",
        "win_title": "",
        "win_name": "",
        "win_phone": "",
        "win_consent": "",
        "win_consent_text": "",
        "win_submit": "",
        "win_thanks": "",
        "sheet_fail": "",
        "sheet_ok": "",
        "mbti_submit": "ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒÑ‚Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑƒĞ²Ğ¸Ğ´ĞµÑ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚.",
    },
    "hi": {
        "lang_pick": "à¤­à¤¾à¤·à¤¾",
        "title": "2026 à¤°à¤¾à¤¶à¤¿ + MBTI + à¤¸à¤¾à¤œà¥‚ + à¤†à¤œ/à¤•à¤²",
        "subtitle": "à¤ªà¥‚à¤°à¥€ à¤¤à¤°à¤¹ à¤®à¥à¤«à¤¼à¥à¤¤",
        "name": "à¤¨à¤¾à¤® (à¤ªà¤°à¤¿à¤£à¤¾à¤® à¤®à¥‡à¤‚ à¤¦à¤¿à¤–à¥‡à¤—à¤¾)",
        "birth": "à¤œà¤¨à¥à¤®à¤¤à¤¿à¤¥à¤¿",
        "year": "à¤µà¤°à¥à¤·",
        "month": "à¤®à¤¹à¥€à¤¨à¤¾",
        "day": "à¤¦à¤¿à¤¨",
        "mbti_mode": "MBTI à¤•à¥ˆà¤¸à¥‡ à¤¸à¥‡à¤Ÿ à¤•à¤°à¥‡à¤‚?",
        "mbti_direct": "à¤¸à¥€à¤§à¥‡ à¤šà¥à¤¨à¥‡à¤‚",
        "mbti_12": "à¤•à¥à¤µà¤¿à¤• à¤Ÿà¥‡à¤¸à¥à¤Ÿ (12)",
        "mbti_16": "à¤«à¥à¤² à¤Ÿà¥‡à¤¸à¥à¤Ÿ (16)",
        "go_result": "2026 à¤•à¤¿à¤¸à¥à¤®à¤¤ à¤¦à¥‡à¤–à¥‡à¤‚",
        "reset": "à¤«à¤¿à¤° à¤¸à¥‡ à¤¶à¥à¤°à¥‚",
        "share_btn": "à¤¶à¥‡à¤¯à¤° à¤•à¤°à¥‡à¤‚",
        "share_hint": "à¤®à¥‹à¤¬à¤¾à¤‡à¤² à¤ªà¤° à¤¶à¥‡à¤¯à¤° à¤¶à¥€à¤Ÿ, PC à¤ªà¤° à¤•à¥‰à¤ªà¥€à¥¤",
        "tarot_btn": "à¤†à¤œ à¤•à¤¾ à¤Ÿà¥ˆà¤°à¥‹ à¤šà¥à¤¨à¥‡à¤‚",
        "tarot_title": "à¤†à¤œ à¤•à¤¾ à¤Ÿà¥ˆà¤°à¥‹",
        "best_combo": "à¤¬à¥‡à¤¸à¥à¤Ÿ à¤•à¥‰à¤®à¥à¤¬à¥‹!",
        "sections": {
            "zodiac": "à¤°à¤¾à¤¶à¤¿",
            "mbti": "MBTI",
            "saju": "à¤¸à¤¾à¤œà¥‚",
            "today": "à¤†à¤œ",
            "tomorrow": "à¤•à¤²",
            "year_all": "2026 à¤¸à¤®à¤—à¥à¤°",
            "love": "à¤ªà¥à¤¯à¤¾à¤°",
            "money": "à¤§à¤¨",
            "work": "à¤•à¤¾à¤®/à¤ªà¤¢à¤¼à¤¾à¤ˆ",
            "health": "à¤¸à¥à¤µà¤¾à¤¸à¥à¤¥à¥à¤¯",
            "point": "à¤²à¤•à¥€ à¤ªà¥‰à¤‡à¤‚à¤Ÿ",
            "advice": "à¤¸à¤²à¤¾à¤¹",
        },
        "ad_placeholder": "AD (à¤®à¤‚à¤œà¤¼à¥‚à¤°à¥€ à¤•à¥‡ à¤¬à¤¾à¤¦ à¤¦à¤¿à¤–à¥‡à¤—à¤¾)",
        "mini_title": "",
        "mini_desc": "",
        "mini_start": "",
        "mini_stop": "",
        "mini_try_left": "",
        "mini_closed": "",
        "mini_dup": "",
        "mini_need_start": "",
        "mini_result": "",
        "win_title": "",
        "win_name": "",
        "win_phone": "",
        "win_consent": "",
        "win_consent_text": "",
        "win_submit": "",
        "win_thanks": "",
        "sheet_fail": "",
        "sheet_ok": "",
        "mbti_submit": "à¤¸à¤¬à¤®à¤¿à¤Ÿ à¤•à¤°à¤•à¥‡ à¤ªà¤°à¤¿à¤£à¤¾à¤® à¤¦à¥‡à¤–à¥‡à¤‚à¥¤",
    }
}

# =========================================================
# 3) ë°ì´í„°(ìš´ì„¸/ë /MBTI/ì§ˆë¬¸/íƒ€ë¡œ)
# =========================================================
TAROT = {
    "The Fool": {"ko": "ë°”ë³´ - ìƒˆë¡œìš´ ì‹œì‘, ëª¨í—˜", "en": "New beginnings, adventure"},
    "The Magician": {"ko": "ë§ˆë²•ì‚¬ - ì°½ì¡°ë ¥, ì§‘ì¤‘", "en": "Skill, manifestation"},
    "The High Priestess": {"ko": "ì—¬ì‚¬ì œ - ì§ê°, ë‚´ë©´", "en": "Intuition, inner voice"},
    "The Empress": {"ko": "ì—¬ì œ - í’ìš”, ì°½ì‘", "en": "Abundance, creativity"},
    "The Emperor": {"ko": "í™©ì œ - ì•ˆì •, êµ¬ì¡°", "en": "Stability, structure"},
    "The Lovers": {"ko": "ì—°ì¸ - ì„ íƒ, ì¡°í™”", "en": "Choices, harmony"},
    "The Chariot": {"ko": "ì „ì°¨ - ìŠ¹ë¦¬, ì˜ì§€", "en": "Willpower, victory"},
    "Strength": {"ko": "í˜ - ìš©ê¸°, ì¸ë‚´", "en": "Courage, patience"},
    "Wheel of Fortune": {"ko": "ìš´ëª…ì˜ ìˆ˜ë ˆë°”í€´ - ë³€í™”", "en": "Cycles, change"},
    "The Sun": {"ko": "íƒœì–‘ - í–‰ë³µ, ì„±ê³µ", "en": "Joy, success"},
    "The World": {"ko": "ì„¸ê³„ - ì™„ì„±, ì„±ì·¨", "en": "Completion, achievement"},
}

ZODIAC_ORDER = ["rat", "ox", "tiger", "rabbit", "dragon", "snake", "horse", "goat", "monkey", "rooster", "dog", "pig"]
ZODIAC_LABEL = {
    "rat":     {"ko": "ì¥ë ", "en": "Rat", "ja": "é¼ ", "zh": "é¼ ", "ru": "ĞšÑ€Ñ‹ÑĞ°", "hi": "à¤šà¥‚à¤¹à¤¾"},
    "ox":      {"ko": "ì†Œë ", "en": "Ox", "ja": "ç‰›", "zh": "ç‰›", "ru": "Ğ‘Ñ‹Ğº", "hi": "à¤¬à¥ˆà¤²"},
    "tiger":   {"ko": "í˜¸ë‘ì´ë ", "en": "Tiger", "ja": "è™", "zh": "è™", "ru": "Ğ¢Ğ¸Ğ³Ñ€", "hi": "à¤¬à¤¾à¤˜"},
    "rabbit":  {"ko": "í† ë¼ë ", "en": "Rabbit", "ja": "å…", "zh": "å…”", "ru": "ĞšÑ€Ğ¾Ğ»Ğ¸Ğº", "hi": "à¤–à¤°à¤—à¥‹à¤¶"},
    "dragon":  {"ko": "ìš©ë ", "en": "Dragon", "ja": "é¾", "zh": "é¾™", "ru": "Ğ”Ñ€Ğ°ĞºĞ¾Ğ½", "hi": "à¤¡à¥à¤°à¥ˆà¤—à¤¨"},
    "snake":   {"ko": "ë±€ë ", "en": "Snake", "ja": "è›‡", "zh": "è›‡", "ru": "Ğ—Ğ¼ĞµÑ", "hi": "à¤¸à¤¾à¤à¤ª"},
    "horse":   {"ko": "ë§ë ", "en": "Horse", "ja": "é¦¬", "zh": "é©¬", "ru": "Ğ›Ğ¾ÑˆĞ°Ğ´ÑŒ", "hi": "à¤˜à¥‹à¤¡à¤¼à¤¾"},
    "goat":    {"ko": "ì–‘ë ", "en": "Goat", "ja": "ç¾Š", "zh": "ç¾Š", "ru": "ĞšĞ¾Ğ·Ğ°", "hi": "à¤¬à¤•à¤°à¥€"},
    "monkey":  {"ko": "ì›ìˆ­ì´ë ", "en": "Monkey", "ja": "çŒ¿", "zh": "çŒ´", "ru": "ĞĞ±ĞµĞ·ÑŒÑĞ½Ğ°", "hi": "à¤¬à¤‚à¤¦à¤°"},
    "rooster": {"ko": "ë‹­ë ", "en": "Rooster", "ja": "é¶", "zh": "é¸¡", "ru": "ĞŸĞµÑ‚ÑƒÑ…", "hi": "à¤®à¥à¤°à¥à¤—à¤¾"},
    "dog":     {"ko": "ê°œë ", "en": "Dog", "ja": "çŠ¬", "zh": "ç‹—", "ru": "Ğ¡Ğ¾Ğ±Ğ°ĞºĞ°", "hi": "à¤•à¥à¤¤à¥à¤¤à¤¾"},
    "pig":     {"ko": "ë¼ì§€ë ", "en": "Pig", "ja": "çŒª", "zh": "çŒª", "ru": "Ğ¡Ğ²Ğ¸Ğ½ÑŒÑ", "hi": "à¤¸à¥‚à¤…à¤°"},
}

ZODIAC_TEXT = {
    "rat":     {"ko": "ë¯¼ì²©í•œ íŒë‹¨ìœ¼ë¡œ ê¸°íšŒë¥¼ ì¡ëŠ” í•´.", "en": "Quick decisions bring opportunities."},
    "ox":      {"ko": "ê¾¸ì¤€í•¨ì˜ ê²°ì‹¤. ì•ˆì •ì  ì„±ì¥.", "en": "Steady effort pays off."},
    "tiger":   {"ko": "ë„ì „ê³¼ ì„±ê³¼. ë¦¬ë”ì‹­ì´ ë¹›ë‚¨.", "en": "Bold challenges lead to wins."},
    "rabbit":  {"ko": "ì‹ ì¤‘í•¨ì´ ìš´ì„ ì§€í‚´. ë¬´ë¦¬ ê¸ˆì§€.", "en": "Caution protects your luck."},
    "dragon":  {"ko": "ìš´ê¸° ìƒìŠ¹. ì¸ì •/ìŠ¹ì§„ íë¦„.", "en": "Rising fortune and recognition."},
    "snake":   {"ko": "ì§ê°ì´ ëˆì´ ë¨. ì‹¤ì† ì±™ê¸°ê¸°.", "en": "Intuition brings practical gains."},
    "horse":   {"ko": "ì¶”ì§„ë ¥ ê°•í•¨. ê· í˜•ì´ í•µì‹¬.", "en": "Strong driveâ€”balance matters."},
    "goat":    {"ko": "í¸ì•ˆí•¨ ì† ëˆìš´. ê°€ì¡±ìš´ ì¢‹ìŒ.", "en": "Comfort with stable money luck."},
    "monkey":  {"ko": "ë³€í™”/ì¬ëŠ¥ ë°œíœ˜. ì°½ì˜ë ¥ ìƒìŠ¹.", "en": "Creativity shines in change."},
    "rooster": {"ko": "ë…¸ë ¥ ê²°ì‹¤. í‰ê°€/ì¸ì • ìš´.", "en": "Effort gets rewarded."},
    "dog":     {"ko": "ê·€ì¸ìš´. ë„¤íŠ¸ì›Œí‚¹ì´ ê´€ê±´.", "en": "Helpful people via networking."},
    "pig":     {"ko": "ì—¬ìœ ì™€ ì¬ë¬¼. ì¦ê¸°ë©° í™•ì¥.", "en": "Relaxation and wealth grow."},
}

MBTI_DESC = {
    "INTJ": {"ko": "ì „ëµê°€ Â· ëª©í‘œì§€í–¥", "en": "Strategist Â· goal-driven"},
    "INTP": {"ko": "ì•„ì´ë””ì–´ Â· ë¶„ì„ê°€", "en": "Analyst Â· idea-driven"},
    "ENTJ": {"ko": "ë¦¬ë” Â· ì¶”ì§„ë ¥", "en": "Leader Â· decisive"},
    "ENTP": {"ko": "í† ë¡ ê°€ Â· ë°œìƒê°€", "en": "Inventor Â· debater"},
    "INFJ": {"ko": "í†µì°° Â· ì¡°ì–¸ì", "en": "Insightful Â· advisor"},
    "INFP": {"ko": "ê°€ì¹˜ Â· ê°ì„±", "en": "Values Â· empathic"},
    "ENFJ": {"ko": "ì¡°ìœ¨ Â· ë¦¬ë”", "en": "Coordinator Â· leader"},
    "ENFP": {"ko": "ì—´ì • Â· ì•„ì´ë””ì–´", "en": "Energetic Â· creative"},
    "ISTJ": {"ko": "ì›ì¹™ Â· ì±…ì„", "en": "Responsible Â· orderly"},
    "ISFJ": {"ko": "ë°°ë ¤ Â· í—Œì‹ ", "en": "Caring Â· supportive"},
    "ESTJ": {"ko": "ê´€ë¦¬ì Â· í˜„ì‹¤/ì„±ê³¼", "en": "Executor Â· practical"},
    "ESFJ": {"ko": "ë¶„ìœ„ê¸° Â· ì¼€ì–´", "en": "Warm Â· community"},
    "ISTP": {"ko": "ì¥ì¸ Â· ë¬¸ì œí•´ê²°", "en": "Tinkerer Â· solver"},
    "ISFP": {"ko": "ê°ì„± Â· íëŸ¬", "en": "Gentle Â· artistic"},
    "ESTP": {"ko": "ëª¨í—˜ Â· ì‹¤í–‰", "en": "Action Â· risk-taking"},
    "ESFP": {"ko": "ì‚¬êµ Â· ì¦ê±°ì›€", "en": "Fun Â· social"},
}

SAJU_MSGS = {
    "ko": [
        "ì˜¤í–‰ ê· í˜• â†’ ë¬´ë¦¬í•˜ì§€ ì•Šìœ¼ë©´ ì „ë°˜ì ìœ¼ë¡œ ëŒ€ê¸¸!",
        "ëª©(æœ¨) ê¸°ìš´ â†’ ì„±ì¥ê³¼ í™•ì¥ì˜ í•´!",
        "í™”(ç«) ê¸°ìš´ â†’ ì—´ì •ì´ ì„±ê³¼ë¡œ ì—°ê²°!",
        "í† (åœŸ) ê¸°ìš´ â†’ ì•ˆì •ê³¼ ì¬ë¬¼ìš´ ê°•í™”!",
        "ê¸ˆ(é‡‘) ê¸°ìš´ â†’ ê²°ë‹¨ì´ ìš´ì„ ì—°ë‹¤!",
        "ìˆ˜(æ°´) ê¸°ìš´ â†’ íë¦„ì„ íƒ€ë©´ ê¸°íšŒê°€ ì˜¨ë‹¤!",
    ],
    "en": [
        "Balanced elements â†’ steady luck if you don't overdo.",
        "Wood â†’ growth and expansion year.",
        "Fire â†’ passion turns into results.",
        "Earth â†’ stability and wealth strengthen.",
        "Metal â†’ decisive moves open luck.",
        "Water â†’ go with the flow to find chances.",
    ],
}

DAILY = {
    "ko": [
        "ì •ë¦¬í•˜ë©´ ìš´ì´ ì—´ë¦½ë‹ˆë‹¤.",
        "ì‚¬ëŒ ìš´ì´ ê°•í•´ìš”. ì˜¤ëŠ˜ì€ ëŒ€í™”ê°€ ì—´ì‡ !",
        "ì‘ì€ ê¸°íšŒê°€ ì»¤ì§‘ë‹ˆë‹¤. ì¦‰í¥ë³´ë‹¤ ê³„íš!",
        "ì¶©ë™êµ¬ë§¤ë§Œ ë§‰ìœ¼ë©´ ì¬ë¬¼ìš´ì´ ë¶™ì–´ìš”.",
        "ì§‘ì¤‘ë ¥ì´ ì¢‹ì•„ìš”. ì§§ê²Œ ëª°ì…í•˜ë©´ ì„±ê³¼!",
        "ë¬´ë¦¬í•œ ì¼ì •ì€ ê¸ˆë¬¼. ì»¨ë””ì…˜ ê´€ë¦¬ê°€ 1ìˆœìœ„!",
    ],
    "en": [
        "Tidying up opens luck.",
        "People luck is strongâ€”talk is the key.",
        "Small chances growâ€”plan over impulse.",
        "Avoid impulse buys to keep money luck.",
        "Short deep focus brings results.",
        "Don't overbookâ€”health first.",
    ],
}

YEAR_ALL = {
    "ko": [
        "ê¾¸ì¤€í•¨ì´ ëŒ€ë°•ì„ ë§Œë“­ë‹ˆë‹¤. ì‘ì€ ìŠµê´€ì´ í° ê²°ê³¼ë¡œ!",
        "ì‚¬ëŒê³¼ ì¸ì—°ì´ í”¼ì–´ë‚˜ëŠ” í•´. ì†Œê°œ/í˜‘ì—…ìš´ ìƒìŠ¹!",
        "ë„ì „í•˜ë©´ ì„±ê³¼ê°€ ë”°ë¼ì˜µë‹ˆë‹¤. ë‹¨, ë¬´ë¦¬í•œ ë² íŒ…ì€ ê¸ˆì§€!",
        "ì •ë¦¬Â·ì •ëˆì´ ìš´ì„ í‚¤ì›ë‹ˆë‹¤. ë¯¸ë¤„ë‘” ì¼ì„ ì •ë¦¬í•´ë³´ì„¸ìš”.",
    ],
    "en": [
        "Consistency creates big luckâ€”small habits matter.",
        "Connections bloomâ€”collaboration opportunities rise.",
        "Challenges pay off, but avoid reckless bets.",
        "Organizing your life boosts your fortune.",
    ],
}

def combo_advice(lang, zodiac_key, mbti):
    ei = mbti[0]; sn = mbti[1]; tf = mbti[2]; jp = mbti[3]
    if lang == "ko":
        parts = []
        parts.append("ì—°ì• ìš´: " + ("ê°ì • êµë¥˜ê°€ ìš´ì„ í‚¤ì›ë‹ˆë‹¤. ì˜¤ëŠ˜ì€ â€˜ê³µê° í•œ ë§ˆë””â€™ë¥¼ ë¨¼ì €!" if tf == "F"
                                 else "í•´ê²°í•˜ë ¤ ë“¤ê¸°ë³´ë‹¤ â€˜ë“£ê¸°â€™ê°€ í¬ì¸íŠ¸. ë…¼ë¦¬ 50%, ê³µê° 50%!"))
        parts.append("ì¬ë¬¼ìš´: " + ("ê³„íší˜•ì´ë¼ ì§€ì¶œ í†µì œê°€ ê°•ì . ìë™ì´ì²´/ì˜ˆì‚°í‘œë¡œ ìš´ì„ êµ³íˆì„¸ìš”." if jp == "J"
                                 else "ì¦‰í¥ì§€ì¶œë§Œ ë§‰ìœ¼ë©´ í¬ê²Œ ì¢‹ì•„ì ¸ìš”. â€˜24ì‹œê°„ ë£°(í•˜ë£¨ ë’¤ êµ¬ë§¤)â€™ ì¶”ì²œ."))
        parts.append("ì¼/í•™ì—…ìš´: " + ("í°ê·¸ë¦¼ì€ ê°•ì ! ë‹¤ë§Œ ì‹¤í–‰ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ í˜„ì‹¤í™”í•˜ë©´ ì„±ê³¼ í­ë°œ." if sn == "N"
                                  else "ë””í…Œì¼ ê°•ì ! ë°˜ë³µ ë£¨í‹´ì„ ë§Œë“¤ë©´ ì•ˆì •ì ìœ¼ë¡œ ì ìˆ˜/ì„±ê³¼ê°€ ì˜¤ë¦…ë‹ˆë‹¤."))
        parts.append("ê±´ê°•ìš´: " + ("ì‚¬ëŒ ë§Œë‚˜ë©° ê³¼ì—´ë˜ê¸° ì‰¬ì›€. ìˆ˜ë©´/ì¹´í˜ì¸ë§Œ ì¡°ì ˆí•´ë„ ì»¨ë””ì…˜ ê¸‰ìƒìŠ¹." if ei == "E"
                                 else "í˜¼ì íšŒë³µì´ í•µì‹¬. â€˜ì§§ì€ ì‚°ì±…+ìŠ¤íŠ¸ë ˆì¹­ 5ë¶„â€™ì´ ìš´ì„ ë•ìŠµë‹ˆë‹¤."))
        return "\n".join(parts)
    parts = [
        "Love: Balance empathy and listening.",
        "Money: Avoid impulse buys; use a simple budget.",
        "Work/Study: Turn ideas into a checklist and execute.",
        "Health: Keep sleep consistent; short walks help.",
    ]
    return "\n".join(parts)

# =========================================================
# 4) MBTI í…ŒìŠ¤íŠ¸ ì§ˆë¬¸(12/16) - (ì´ì „ ì½”ë“œ ê·¸ëŒ€ë¡œ)
# =========================================================
MBTI_12_Q = {
    "ko": [
        ("ì£¼ë§ì— ê°‘ìê¸° ì•½ì†ì´ ì¡íˆë©´ ë” ì‹ ë‚˜ëŠ” í¸?", ("E", "ì˜ˆ"), ("I", "ì•„ë‹ˆì˜¤")),
        ("ëŒ€í™”í•  ë•Œ ì•„ì´ë””ì–´/ê°€ëŠ¥ì„± ì´ì•¼ê¸°ë¥¼ ë” ìì£¼ í•¨?", ("N", "ì˜ˆ"), ("S", "ì•„ë‹ˆì˜¤")),
        ("ê²°ì •í•  ë•Œ ë…¼ë¦¬/íš¨ìœ¨ì„ ìš°ì„ í•˜ëŠ” í¸?", ("T", "ì˜ˆ"), ("F", "ì•„ë‹ˆì˜¤")),
        ("ì¼ì •ì„ ë¯¸ë¦¬ ê³„íší•˜ëŠ” ê²Œ í¸í•¨?", ("J", "ì˜ˆ"), ("P", "ì•„ë‹ˆì˜¤")),
        ("ë‚¯ì„  ëª¨ì„ì—ì„œë„ ë¨¼ì € ë§ì„ ê±°ëŠ” í¸?", ("E", "ì˜ˆ"), ("I", "ì•„ë‹ˆì˜¤")),
        ("ì„¸ë¶€ë³´ë‹¤ í°ê·¸ë¦¼ì„ ë¨¼ì € ë³´ëŠ” í¸?", ("N", "ì˜ˆ"), ("S", "ì•„ë‹ˆì˜¤")),
        ("ë¬¸ì œ í•´ê²° ì¡°ì–¸ì„ ë¨¼ì € í•˜ëŠ” í¸?", ("T", "ì˜ˆ"), ("F", "ì•„ë‹ˆì˜¤")),
        ("ë§ˆê° ì „ì— ë¯¸ë¦¬ ëë‚´ëŠ” í¸?", ("J", "ì˜ˆ"), ("P", "ì•„ë‹ˆì˜¤")),
        ("í˜¼ìë³´ë‹¨ ê°™ì´ ìˆì„ ë•Œ ì—ë„ˆì§€ ì¶©ì „?", ("E", "ì˜ˆ"), ("I", "ì•„ë‹ˆì˜¤")),
        ("í˜„ì¬ ì‚¬ì‹¤ë³´ë‹¤ ë¯¸ë˜ ê°€ëŠ¥ì„±ì´ ë” í¥ë¯¸?", ("N", "ì˜ˆ"), ("S", "ì•„ë‹ˆì˜¤")),
        ("ê³µê°ë³´ë‹¤ ì •ë‹µì„ ì°¾ìœ¼ë ¤ëŠ” í¸?", ("T", "ì˜ˆ"), ("F", "ì•„ë‹ˆì˜¤")),
        ("ì¦‰í¥ë³´ë‹¤ ì •í•´ì§„ ë°©ì‹ì´ í¸í•¨?", ("J", "ì˜ˆ"), ("P", "ì•„ë‹ˆì˜¤")),
    ],
    "en": [
        ("Weekend plan pops upâ€”do you feel energized?", ("E", "Yes"), ("I", "No")),
        ("Do you talk more about ideas/possibilities?", ("N", "Yes"), ("S", "No")),
        ("Do you prioritize logic/efficiency?", ("T", "Yes"), ("F", "No")),
        ("Do you prefer planning ahead?", ("J", "Yes"), ("P", "No")),
        ("Do you start conversations easily?", ("E", "Yes"), ("I", "No")),
        ("Big picture first, details later?", ("N", "Yes"), ("S", "No")),
        ("Do you give solutions before empathy?", ("T", "Yes"), ("F", "No")),
        ("Finish tasks early before deadline?", ("J", "Yes"), ("P", "No")),
        ("Do you recharge with people?", ("E", "Yes"), ("I", "No")),
        ("Future possibilities interest you more?", ("N", "Yes"), ("S", "No")),
        ("Do you seek the right answer over feelings?", ("T", "Yes"), ("F", "No")),
        ("Prefer structured way over spontaneity?", ("J", "Yes"), ("P", "No")),
    ],
    "ja": [
        ("é€±æœ«ã«æ€¥ãªäºˆå®šãŒå…¥ã‚‹ã¨å…ƒæ°—ã«ãªã‚‹ï¼Ÿ", ("E", "ã¯ã„"), ("I", "ã„ã„ãˆ")),
        ("ä¼šè©±ã§ã‚¢ã‚¤ãƒ‡ã‚¢/å¯èƒ½æ€§ã®è©±ãŒå¤šã„ï¼Ÿ", ("N", "ã¯ã„"), ("S", "ã„ã„ãˆ")),
        ("æ±ºå®šã§è«–ç†/åŠ¹ç‡ã‚’å„ªå…ˆã™ã‚‹ï¼Ÿ", ("T", "ã¯ã„"), ("F", "ã„ã„ãˆ")),
        ("äº‹å‰ã«è¨ˆç”»ã™ã‚‹æ–¹ãŒæ¥½ï¼Ÿ", ("J", "ã¯ã„"), ("P", "ã„ã„ãˆ")),
        ("åˆå¯¾é¢ã§ã‚‚è©±ã—ã‹ã‘ã‚„ã™ã„ï¼Ÿ", ("E", "ã¯ã„"), ("I", "ã„ã„ãˆ")),
        ("ã¾ãšå…¨ä½“åƒã€ã‚ã¨ã§è©³ç´°ï¼Ÿ", ("N", "ã¯ã„"), ("S", "ã„ã„ãˆ")),
        ("å…±æ„Ÿã‚ˆã‚Šè§£æ±ºç­–ã‚’å…ˆã«è¨€ã†ï¼Ÿ", ("T", "ã¯ã„"), ("F", "ã„ã„ãˆ")),
        ("ç· åˆ‡å‰ã«çµ‚ã‚ã‚‰ã›ã‚‹ï¼Ÿ", ("J", "ã¯ã„"), ("P", "ã„ã„ãˆ")),
        ("äººã¨ã„ã‚‹ã¨å……é›»ã§ãã‚‹ï¼Ÿ", ("E", "ã¯ã„"), ("I", "ã„ã„ãˆ")),
        ("ä»Šã‚ˆã‚Šæœªæ¥ã®å¯èƒ½æ€§ãŒå¥½ãï¼Ÿ", ("N", "ã¯ã„"), ("S", "ã„ã„ãˆ")),
        ("æ°—æŒã¡ã‚ˆã‚Šæ­£è§£ã‚’æ¢ã™ï¼Ÿ", ("T", "ã¯ã„"), ("F", "ã„ã„ãˆ")),
        ("å³èˆˆã‚ˆã‚Šæ±ºã¾ã£ãŸã‚„ã‚Šæ–¹ãŒæ¥½ï¼Ÿ", ("J", "ã¯ã„"), ("P", "ã„ã„ãˆ")),
    ],
    "zh": [
        ("å‘¨æœ«çªç„¶æœ‰çº¦ä¼šä¼šæ›´æœ‰ç²¾ç¥ï¼Ÿ", ("E", "æ˜¯"), ("I", "å¦")),
        ("æ›´å¸¸èŠæƒ³æ³•/å¯èƒ½æ€§ï¼Ÿ", ("N", "æ˜¯"), ("S", "å¦")),
        ("åšå†³å®šæ›´çœ‹é‡é€»è¾‘/æ•ˆç‡ï¼Ÿ", ("T", "æ˜¯"), ("F", "å¦")),
        ("æ›´å–œæ¬¢æå‰è®¡åˆ’ï¼Ÿ", ("J", "æ˜¯"), ("P", "å¦")),
        ("åœ¨é™Œç”Ÿèšä¼šä¹Ÿå®¹æ˜“å…ˆå¼€å£ï¼Ÿ", ("E", "æ˜¯"), ("I", "å¦")),
        ("å…ˆçœ‹å¤§å±€ï¼Œåçœ‹ç»†èŠ‚ï¼Ÿ", ("N", "æ˜¯"), ("S", "å¦")),
        ("æ›´å€¾å‘å…ˆç»™è§£å†³æ–¹æ¡ˆï¼Ÿ", ("T", "æ˜¯"), ("F", "å¦")),
        ("å–œæ¬¢æå‰å®Œæˆä»»åŠ¡ï¼Ÿ", ("J", "æ˜¯"), ("P", "å¦")),
        ("å’Œäººä¸€èµ·æ›´èƒ½å……ç”µï¼Ÿ", ("E", "æ˜¯"), ("I", "å¦")),
        ("æ¯”èµ·ç°åœ¨æ›´å–œæ¬¢æœªæ¥å¯èƒ½ï¼Ÿ", ("N", "æ˜¯"), ("S", "å¦")),
        ("æ¯”èµ·æ„Ÿå—æ›´æƒ³æ‰¾æ­£ç¡®ç­”æ¡ˆï¼Ÿ", ("T", "æ˜¯"), ("F", "å¦")),
        ("æ›´å–œæ¬¢å›ºå®šæ–¹å¼è€Œéå³å…´ï¼Ÿ", ("J", "æ˜¯"), ("P", "å¦")),
    ],
    "ru": [
        ("Ğ’Ğ½ĞµĞ·Ğ°Ğ¿Ğ½Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ğ½ Ğ½Ğ° Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ·Ğ°Ñ€ÑĞ¶Ğ°ĞµÑ‚?", ("E", "Ğ”Ğ°"), ("I", "ĞĞµÑ‚")),
        ("Ğ§Ğ°Ñ‰Ğµ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ğ¾Ğ± Ğ¸Ğ´ĞµÑÑ…/Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑÑ…?", ("N", "Ğ”Ğ°"), ("S", "ĞĞµÑ‚")),
        ("Ğ’ Ñ€ĞµÑˆĞµĞ½Ğ¸ÑÑ… Ğ²Ğ°Ğ¶Ğ½ĞµĞµ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°/ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ?", ("T", "Ğ”Ğ°"), ("F", "ĞĞµÑ‚")),
        ("Ğ›ÑĞ±Ğ¸Ñ‚Ğµ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ°Ñ€Ğ°Ğ½ĞµĞµ?", ("J", "Ğ”Ğ°"), ("P", "ĞĞµÑ‚")),
        ("Ğ›ĞµĞ³ĞºĞ¾ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€ Ñ Ğ½ĞµĞ·Ğ½Ğ°ĞºĞ¾Ğ¼Ñ‹Ğ¼Ğ¸?", ("E", "Ğ”Ğ°"), ("I", "ĞĞµÑ‚")),
        ("Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½Ğ° Ñ†ĞµĞ»Ğ¸ĞºĞ¾Ğ¼, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸?", ("N", "Ğ”Ğ°"), ("S", "ĞĞµÑ‚")),
        ("Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ´Ğ°Ñ‘Ñ‚Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ ÑĞ¾Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ğµ?", ("T", "Ğ”Ğ°"), ("F", "ĞĞµÑ‚")),
        ("Ğ”ĞµĞ»Ğ°ĞµÑ‚Ğµ Ğ·Ğ°Ñ€Ğ°Ğ½ĞµĞµ Ğ´Ğ¾ Ğ´ĞµĞ´Ğ»Ğ°Ğ¹Ğ½Ğ°?", ("J", "Ğ”Ğ°"), ("P", "ĞĞµÑ‚")),
        ("Ğ¡ Ğ»ÑĞ´ÑŒĞ¼Ğ¸ Ğ²Ñ‹ Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ĞµÑÑŒ?", ("E", "Ğ”Ğ°"), ("I", "ĞĞµÑ‚")),
        ("Ğ‘ÑƒĞ´ÑƒÑ‰ĞµĞµ Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ½ĞµĞµ Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ĞµĞ³Ğ¾?", ("N", "Ğ”Ğ°"), ("S", "ĞĞµÑ‚")),
        ("Ğ˜Ñ‰ĞµÑ‚Ğµ â€œĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚â€ Ğ²Ğ°Ğ¶Ğ½ĞµĞµ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¹?", ("T", "Ğ”Ğ°"), ("F", "ĞĞµÑ‚")),
        ("ĞŸÑ€ĞµĞ´Ğ¿Ğ¾Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚Ğµ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ ÑĞ¿Ğ¾Ğ½Ñ‚Ğ°Ğ½Ğ½Ğ¾ÑÑ‚Ğ¸?", ("J", "Ğ”Ğ°"), ("P", "ĞĞµÑ‚")),
    ],
    "hi": [
        ("à¤µà¥€à¤•à¥‡à¤‚à¤¡ à¤ªà¤° à¤…à¤šà¤¾à¤¨à¤• à¤ªà¥à¤²à¤¾à¤¨ à¤¬à¤¨à¥‡ à¤¤à¥‹ à¤Šà¤°à¥à¤œà¤¾ à¤¬à¤¢à¤¼à¤¤à¥€ à¤¹à¥ˆ?", ("E", "à¤¹à¤¾à¤"), ("I", "à¤¨à¤¹à¥€à¤‚")),
        ("à¤†à¤ª à¤œà¤¼à¥à¤¯à¤¾à¤¦à¤¾ à¤µà¤¿à¤šà¤¾à¤°/à¤¸à¤‚à¤­à¤¾à¤µà¤¨à¤¾à¤à¤ à¤¬à¤¾à¤¤ à¤•à¤°à¤¤à¥‡ à¤¹à¥ˆà¤‚?", ("N", "à¤¹à¤¾à¤"), ("S", "à¤¨à¤¹à¥€à¤‚")),
        ("à¤¨à¤¿à¤°à¥à¤£à¤¯ à¤®à¥‡à¤‚ à¤¤à¤°à¥à¤•/à¤¦à¤•à¥à¤·à¤¤à¤¾ à¤ªà¤¹à¤²à¥‡?", ("T", "à¤¹à¤¾à¤"), ("F", "à¤¨à¤¹à¥€à¤‚")),
        ("à¤ªà¤¹à¤²à¥‡ à¤¸à¥‡ à¤¯à¥‹à¤œà¤¨à¤¾ à¤¬à¤¨à¤¾à¤¨à¤¾ à¤ªà¤¸à¤‚à¤¦?", ("J", "à¤¹à¤¾à¤"), ("P", "à¤¨à¤¹à¥€à¤‚")),
        ("à¤…à¤œà¤¨à¤¬à¤¿à¤¯à¥‹à¤‚ à¤¸à¥‡ à¤¬à¤¾à¤¤ à¤¶à¥à¤°à¥‚ à¤•à¤°à¤¨à¤¾ à¤†à¤¸à¤¾à¤¨?", ("E", "à¤¹à¤¾à¤"), ("I", "à¤¨à¤¹à¥€à¤‚")),
        ("à¤ªà¤¹à¤²à¥‡ à¤¬à¤¡à¤¼à¤¾ à¤šà¤¿à¤¤à¥à¤°, à¤«à¤¿à¤° à¤µà¤¿à¤µà¤°à¤£?", ("N", "à¤¹à¤¾à¤"), ("S", "à¤¨à¤¹à¥€à¤‚")),
        ("à¤ªà¤¹à¤²à¥‡ à¤¸à¤®à¤¾à¤§à¤¾à¤¨, à¤«à¤¿à¤° à¤¸à¤¹à¤¾à¤¨à¥à¤­à¥‚à¤¤à¤¿?", ("T", "à¤¹à¤¾à¤"), ("F", "à¤¨à¤¹à¥€à¤‚")),
        ("à¤¡à¥‡à¤¡à¤²à¤¾à¤‡à¤¨ à¤¸à¥‡ à¤ªà¤¹à¤²à¥‡ à¤ªà¥‚à¤°à¤¾ à¤•à¤°à¤¨à¤¾ à¤ªà¤¸à¤‚à¤¦?", ("J", "à¤¹à¤¾à¤"), ("P", "à¤¨à¤¹à¥€à¤‚")),
        ("à¤²à¥‹à¤—à¥‹à¤‚ à¤•à¥‡ à¤¸à¤¾à¤¥ à¤°à¤¹à¤•à¤° à¤°à¤¿à¤šà¤¾à¤°à¥à¤œ à¤¹à¥‹à¤¤à¥‡ à¤¹à¥ˆà¤‚?", ("E", "à¤¹à¤¾à¤"), ("I", "à¤¨à¤¹à¥€à¤‚")),
        ("à¤­à¤µà¤¿à¤·à¥à¤¯ à¤•à¥€ à¤¸à¤‚à¤­à¤¾à¤µà¤¨à¤¾ à¤œà¤¼à¥à¤¯à¤¾à¤¦à¤¾ à¤°à¥‹à¤šà¤•?", ("N", "à¤¹à¤¾à¤"), ("S", "à¤¨à¤¹à¥€à¤‚")),
        ("à¤­à¤¾à¤µà¤¨à¤¾à¤“à¤‚ à¤¸à¥‡ à¤œà¤¼à¥à¤¯à¤¾à¤¦à¤¾ à¤¸à¤¹à¥€ à¤‰à¤¤à¥à¤¤à¤°?", ("T", "à¤¹à¤¾à¤"), ("F", "à¤¨à¤¹à¥€à¤‚")),
        ("à¤¸à¥à¤ªà¥‰à¤¨à¥à¤Ÿà¥‡à¤¨à¤¿à¤¯à¤¸ à¤¸à¥‡ à¤œà¤¼à¥à¤¯à¤¾à¤¦à¤¾ à¤¸à¤‚à¤°à¤šà¤¨à¤¾ à¤ªà¤¸à¤‚à¤¦?", ("J", "à¤¹à¤¾à¤"), ("P", "à¤¨à¤¹à¥€à¤‚")),
    ],
}

MBTI_16_Q = {
    "ko": {
        "E/I": [
            "ì‚¬ëŒ ë§ì€ ìë¦¬ì—ì„œ ì—ë„ˆì§€ê°€ ì˜¬ë¼ê°„ë‹¤.",
            "ìƒˆë¡œìš´ ì‚¬ëŒê³¼ ëŒ€í™”ê°€ ë¶€ë‹´ìŠ¤ëŸ½ì§€ ì•Šë‹¤.",
            "ìƒê°ì€ ë§ë¡œ ì •ë¦¬í•˜ëŠ” í¸ì´ë‹¤.",
            "í˜¼ìë³´ë‹¤ í•¨ê»˜í•  ë•Œ ê¸°ë¶„ì´ ì¢‹ì•„ì§„ë‹¤.",
        ],
        "S/N": [
            "í˜„ì¬ ì‚¬ì‹¤/ë°ì´í„°ë¥¼ ë¨¼ì € ë³¸ë‹¤.",
            "ë””í…Œì¼ì„ ë†“ì¹˜ì§€ ì•ŠëŠ” í¸ì´ë‹¤.",
            "í˜„ì‹¤ì ì´ê³  êµ¬ì²´ì ì¸ ì„¤ëª…ì´ í¸í•˜ë‹¤.",
            "ê²½í—˜ ê¸°ë°˜ìœ¼ë¡œ íŒë‹¨í•œë‹¤.",
        ],
        "T/F": [
            "ê°ì •ë³´ë‹¤ ê¸°ì¤€/ì›ì¹™ì´ ì¤‘ìš”í•˜ë‹¤.",
            "ê³µì •í•¨ì´ ìµœìš°ì„ ì´ë¼ê³  ëŠë‚€ë‹¤.",
            "ë¬¸ì œëŠ” í•´ê²°í•´ì•¼ ë§ˆìŒì´ í¸í•˜ë‹¤.",
            "ìƒí™©ì—ì„œ ë…¼ë¦¬ë¥¼ ë¨¼ì € ë³¸ë‹¤.",
        ],
        "J/P": [
            "ê³„íšì´ ìˆì–´ì•¼ ë§ˆìŒì´ í¸í•˜ë‹¤.",
            "ë§ˆê° ì „ì— ë¯¸ë¦¬ ëë‚´ëŠ” í¸ì´ë‹¤.",
            "ì •ë¦¬ì •ëˆ/ì²´ê³„ê°€ ì¤‘ìš”í•˜ë‹¤.",
            "ê²°ì •ì€ ë¹ ë¥´ê²Œ ë‚´ë¦¬ê³  ì§„í–‰í•œë‹¤.",
        ],
        "yes": "ì˜ˆ",
        "no": "ì•„ë‹ˆì˜¤",
    },
    "en": {
        "E/I": [
            "Crowds energize me.",
            "Talking to new people isn't too hard.",
            "I organize thoughts by speaking.",
            "I feel better with people than alone.",
        ],
        "S/N": [
            "I look at facts/data first.",
            "I rarely miss details.",
            "Concrete explanations feel easier.",
            "I judge based on experience.",
        ],
        "T/F": [
            "Principles matter more than feelings.",
            "Fairness feels most important.",
            "I feel better after solving the problem.",
            "I look for logic first.",
        ],
        "J/P": [
            "I feel calm with a plan.",
            "I finish before deadline.",
            "Order and systems matter.",
            "I decide quickly and move on.",
        ],
        "yes": "Yes",
        "no": "No",
    },
    "ja": {
        "E/I": [
            "äººãŒå¤šã„å ´æ‰€ã§å…ƒæ°—ã«ãªã‚‹ã€‚",
            "æ–°ã—ã„äººã¨ã®ä¼šè©±ã¯è‹¦ã§ã¯ãªã„ã€‚",
            "è©±ã—ãªãŒã‚‰è€ƒãˆãŒæ•´ç†ã§ãã‚‹ã€‚",
            "ä¸€äººã‚ˆã‚Šèª°ã‹ã¨ã„ã‚‹æ–¹ãŒæ¥½ã—ã„ã€‚",
        ],
        "S/N": [
            "äº‹å®Ÿ/ãƒ‡ãƒ¼ã‚¿ã‚’å…ˆã«è¦‹ã‚‹ã€‚",
            "ç´°éƒ¨ã‚’è¦‹è½ã¨ã—ã«ãã„ã€‚",
            "å…·ä½“çš„ãªèª¬æ˜ã®æ–¹ãŒæ¥½ã€‚",
            "çµŒé¨“ã‚’ã‚‚ã¨ã«åˆ¤æ–­ã™ã‚‹ã€‚",
        ],
        "T/F": [
            "æ„Ÿæƒ…ã‚ˆã‚ŠåŸå‰‡ãŒå¤§äº‹ã€‚",
            "å…¬å¹³ã•ãŒæœ€å„ªå…ˆã ã€‚",
            "å•é¡ŒãŒè§£æ±ºã™ã‚‹ã¨å®‰å¿ƒã€‚",
            "ã¾ãšè«–ç†ã‚’è€ƒãˆã‚‹ã€‚",
        ],
        "J/P": [
            "è¨ˆç”»ãŒã‚ã‚‹ã¨è½ã¡ç€ãã€‚",
            "ç· åˆ‡å‰ã«çµ‚ã‚ã‚‰ã›ã‚‹ã€‚",
            "æ•´ç†æ•´é “ãŒå¤§äº‹ã€‚",
            "æ±ºã‚ãŸã‚‰ã™ãé€²ã‚ã‚‹ã€‚",
        ],
        "yes": "ã¯ã„",
        "no": "ã„ã„ãˆ",
    },
    "zh": {
        "E/I": [
            "äººå¤šçš„åœºåˆè®©æˆ‘æ›´æœ‰ç²¾ç¥ã€‚",
            "å’Œé™Œç”ŸäººèŠå¤©ä¸ç®—å›°éš¾ã€‚",
            "æˆ‘ä¼šé€šè¿‡è¯´å‡ºæ¥æ•´ç†æƒ³æ³•ã€‚",
            "ä¸äººä¸€èµ·æ¯”ç‹¬å¤„æ›´èˆ’æœã€‚",
        ],
        "S/N": [
            "æˆ‘å…ˆçœ‹äº‹å®/æ•°æ®ã€‚",
            "æˆ‘ä¸å¤ªä¼šæ¼æ‰ç»†èŠ‚ã€‚",
            "å…·ä½“è¯´æ˜æ›´å®¹æ˜“ç†è§£ã€‚",
            "æˆ‘åŸºäºç»éªŒåšåˆ¤æ–­ã€‚",
        ],
        "T/F": [
            "åŸåˆ™æ¯”æƒ…ç»ªæ›´é‡è¦ã€‚",
            "æˆ‘æŠŠå…¬å¹³çœ‹å¾—å¾ˆé‡ã€‚",
            "è§£å†³é—®é¢˜åæ‰å®‰å¿ƒã€‚",
            "æˆ‘å…ˆçœ‹é€»è¾‘ã€‚",
        ],
        "J/P": [
            "æœ‰è®¡åˆ’æˆ‘æ›´è¸å®ã€‚",
            "æˆ‘ä¼šæå‰å®Œæˆã€‚",
            "æˆ‘é‡è§†æ•´ç†å’Œç³»ç»Ÿã€‚",
            "æˆ‘ä¼šè¾ƒå¿«åšå†³å®šå¹¶æ¨è¿›ã€‚",
        ],
        "yes": "æ˜¯",
        "no": "å¦",
    },
    "ru": {
        "E/I": [
            "Ğ’ Ğ»ÑĞ´Ğ½Ñ‹Ñ… Ğ¼ĞµÑÑ‚Ğ°Ñ… Ñ Ğ·Ğ°Ñ€ÑĞ¶Ğ°ÑÑÑŒ.",
            "Ğ Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€ Ñ Ğ½Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ Ğ»ÑĞ´ÑŒĞ¼Ğ¸ Ğ½Ğµ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ ÑĞ»Ğ¾Ğ¶ĞµĞ½.",
            "Ğ¯ Ğ»ÑƒÑ‡ÑˆĞµ Ğ´ÑƒĞ¼Ğ°Ñ, ĞºĞ¾Ğ³Ğ´Ğ° Ğ³Ğ¾Ğ²Ğ¾Ñ€Ñ.",
            "Ğ¡ Ğ»ÑĞ´ÑŒĞ¼Ğ¸ Ğ¼Ğ½Ğµ Ğ»ĞµĞ³Ñ‡Ğµ, Ñ‡ĞµĞ¼ Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ.",
        ],
        "S/N": [
            "Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑĞ¼Ğ¾Ñ‚Ñ€Ñ Ğ½Ğ° Ñ„Ğ°ĞºÑ‚Ñ‹/Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ.",
            "Ğ ĞµĞ´ĞºĞ¾ ÑƒĞ¿ÑƒÑĞºĞ°Ñ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸.",
            "ĞšĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğµ Ğ¾Ğ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ‰Ğµ.",
            "ĞÑ†ĞµĞ½Ğ¸Ğ²Ğ°Ñ Ğ¿Ğ¾ Ğ¾Ğ¿Ñ‹Ñ‚Ñƒ.",
        ],
        "T/F": [
            "ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹ Ğ²Ğ°Ğ¶Ğ½ĞµĞµ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¹.",
            "Ğ¡Ğ¿Ñ€Ğ°Ğ²ĞµĞ´Ğ»Ğ¸Ğ²Ğ¾ÑÑ‚ÑŒ Ğ´Ğ»Ñ Ğ¼ĞµĞ½Ñ Ğ²Ğ°Ğ¶Ğ½Ğ°.",
            "ĞœĞ½Ğµ Ğ»ĞµĞ³Ñ‡Ğµ Ğ¿Ğ¾ÑĞ»Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹.",
            "Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¸Ñ‰Ñƒ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ.",
        ],
        "J/P": [
            "Ğ¡ Ğ¿Ğ»Ğ°Ğ½Ğ¾Ğ¼ ÑĞ¿Ğ¾ĞºĞ¾Ğ¹Ğ½ĞµĞµ.",
            "Ğ”ĞµĞ»Ğ°Ñ Ğ·Ğ°Ñ€Ğ°Ğ½ĞµĞµ Ğ´Ğ¾ ÑÑ€Ğ¾ĞºĞ°.",
            "ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ²Ğ°Ğ¶Ğ½Ñ‹.",
            "Ğ ĞµÑˆĞ°Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾ Ğ¸ Ğ´ĞµĞ¹ÑÑ‚Ğ²ÑƒÑ.",
        ],
        "yes": "Ğ”Ğ°",
        "no": "ĞĞµÑ‚",
    },
    "hi": {
        "E/I": [
            "à¤­à¥€à¤¡à¤¼ à¤®à¥‡à¤‚ à¤®à¥à¤à¥‡ à¤Šà¤°à¥à¤œà¤¾ à¤®à¤¿à¤²à¤¤à¥€ à¤¹à¥ˆà¥¤",
            "à¤¨à¤ à¤²à¥‹à¤—à¥‹à¤‚ à¤¸à¥‡ à¤¬à¤¾à¤¤ à¤•à¤°à¤¨à¤¾ à¤®à¥à¤¶à¥à¤•à¤¿à¤² à¤¨à¤¹à¥€à¤‚à¥¤",
            "à¤¬à¥‹à¤²à¤•à¤° à¤¸à¥‹à¤š à¤µà¥à¤¯à¤µà¤¸à¥à¤¥à¤¿à¤¤ à¤¹à¥‹à¤¤à¥€ à¤¹à¥ˆà¥¤",
            "à¤²à¥‹à¤—à¥‹à¤‚ à¤•à¥‡ à¤¸à¤¾à¤¥ à¤…à¤•à¥‡à¤²à¥‡ à¤¸à¥‡ à¤¬à¥‡à¤¹à¤¤à¤° à¤²à¤—à¤¤à¤¾ à¤¹à¥ˆà¥¤",
        ],
        "S/N": [
            "à¤®à¥ˆà¤‚ à¤ªà¤¹à¤²à¥‡ à¤¤à¤¥à¥à¤¯/à¤¡à¥‡à¤Ÿà¤¾ à¤¦à¥‡à¤–à¤¤à¤¾ à¤¹à¥‚à¤à¥¤",
            "à¤®à¥ˆà¤‚ à¤µà¤¿à¤µà¤°à¤£ à¤•à¤® à¤¹à¥€ à¤›à¥‹à¤¡à¤¼à¤¤à¤¾ à¤¹à¥‚à¤à¥¤",
            "à¤ à¥‹à¤¸/à¤¸à¥à¤ªà¤·à¥à¤Ÿ à¤¸à¤®à¤à¤¾à¤¨à¤¾ à¤†à¤¸à¤¾à¤¨ à¤²à¤—à¤¤à¤¾ à¤¹à¥ˆà¥¤",
            "à¤®à¥ˆà¤‚ à¤…à¤¨à¥à¤­à¤µ à¤•à¥‡ à¤†à¤§à¤¾à¤° à¤ªà¤° à¤¨à¤¿à¤°à¥à¤£à¤¯ à¤²à¥‡à¤¤à¤¾ à¤¹à¥‚à¤à¥¤",
        ],
        "T/F": [
            "à¤­à¤¾à¤µà¤¨à¤¾à¤“à¤‚ à¤¸à¥‡ à¤œà¤¼à¥à¤¯à¤¾à¤¦à¤¾ à¤¸à¤¿à¤¦à¥à¤§à¤¾à¤‚à¤¤ à¤œà¤¼à¤°à¥‚à¤°à¥€à¥¤",
            "à¤®à¥‡à¤°à¥‡ à¤²à¤¿à¤ à¤¨à¤¿à¤·à¥à¤ªà¤•à¥à¤·à¤¤à¤¾ à¤…à¤¹à¤® à¤¹à¥ˆà¥¤",
            "à¤¸à¤®à¤¸à¥à¤¯à¤¾ à¤¹à¤² à¤¹à¥‹à¤¨à¥‡ à¤ªà¤° à¤°à¤¾à¤¹à¤¤ à¤®à¤¿à¤²à¤¤à¥€ à¤¹à¥ˆà¥¤",
            "à¤®à¥ˆà¤‚ à¤ªà¤¹à¤²à¥‡ à¤¤à¤°à¥à¤• à¤¦à¥‡à¤–à¤¤à¤¾ à¤¹à¥‚à¤à¥¤",
        ],
        "J/P": [
            "à¤¯à¥‹à¤œà¤¨à¤¾ à¤¸à¥‡ à¤®à¤¨ à¤¶à¤¾à¤‚à¤¤ à¤°à¤¹à¤¤à¤¾ à¤¹à¥ˆà¥¤",
            "à¤®à¥ˆà¤‚ à¤¡à¥‡à¤¡à¤²à¤¾à¤‡à¤¨ à¤¸à¥‡ à¤ªà¤¹à¤²à¥‡ à¤ªà¥‚à¤°à¤¾ à¤•à¤°à¤¤à¤¾ à¤¹à¥‚à¤à¥¤",
            "à¤µà¥à¤¯à¤µà¤¸à¥à¤¥à¤¾/à¤¸à¤¿à¤¸à¥à¤Ÿà¤® à¤®à¤¹à¤¤à¥à¤µà¤ªà¥‚à¤°à¥à¤£ à¤¹à¥ˆà¥¤",
            "à¤®à¥ˆà¤‚ à¤œà¤²à¥à¤¦à¥€ à¤¨à¤¿à¤°à¥à¤£à¤¯ à¤²à¥‡à¤•à¤° à¤†à¤—à¥‡ à¤¬à¤¢à¤¼à¤¤à¤¾ à¤¹à¥‚à¤à¥¤",
        ],
        "yes": "à¤¹à¤¾à¤",
        "no": "à¤¨à¤¹à¥€à¤‚",
    },
}

def calc_zodiac_key(year: int) -> str:
    idx = (year - 4) % 12
    return ZODIAC_ORDER[idx]

def get_saju(lang: str, y: int, m: int, d: int) -> str:
    base = (y + m + d) % 6
    arr = SAJU_MSGS["ko"] if lang == "ko" else SAJU_MSGS["en"]
    return arr[base]

def seeded_daily(lang: str, zodiac_key: str, offset: int = 0) -> str:
    today = datetime.now() + timedelta(days=offset)
    seed = int(today.strftime("%Y%m%d")) + ZODIAC_ORDER.index(zodiac_key) * 17
    random.seed(seed)
    arr = DAILY["ko"] if lang == "ko" else DAILY["en"]
    return random.choice(arr)

def year_overall(lang: str, zodiac_key: str, mbti: str) -> str:
    seed = ZODIAC_ORDER.index(zodiac_key) * 101 + sum(ord(c) for c in mbti)
    random.seed(seed)
    arr = YEAR_ALL["ko"] if lang == "ko" else YEAR_ALL["en"]
    return random.choice(arr)

def pick_tarot(lang: str):
    k = random.choice(list(TAROT.keys()))
    meaning = TAROT[k]["ko"] if lang == "ko" else TAROT[k]["en"]
    return k, meaning

# =========================================================
# 5) êµ¬ê¸€ì‹œíŠ¸ ì—°ê²° (ì»¬ëŸ¼ ê³ ì •)
#     ì‹œê°„ | ì´ë¦„ | ì „í™”ë²ˆí˜¸ | ì–¸ì–´ | ê¸°ë¡ì´ˆ | ê³µìœ ì—¬ë¶€
# =========================================================
def get_sheet():
    if gspread is None or Credentials is None:
        return None
    if "gcp_service_account" not in st.secrets:
        return None

    scopes = [
        "https://www.googleapis.com/auth/spreadsheets",
        "https://www.googleapis.com/auth/drive",
    ]
    info = dict(st.secrets["gcp_service_account"])

    if "private_key" in info and isinstance(info["private_key"], str):
        info["private_key"] = info["private_key"].replace("\\n", "\n")

    creds = Credentials.from_service_account_info(info, scopes=scopes)
    gc = gspread.authorize(creds)
    sh = gc.open_by_key(SPREADSHEET_ID)
    ws = sh.worksheet(SHEET_NAME)
    return ws

def normalize_phone(phone: str) -> str:
    return re.sub(r"[^0-9]", "", phone or "")

def read_all_rows(ws):
    return ws.get_all_values()

def count_winners(ws) -> int:
    values = read_all_rows(ws)
    winners = 0
    for row in values[1:] if len(values) > 0 else []:
        if len(row) < 6:
            continue
        try:
            sec = float(row[4])
        except Exception:
            continue
        if 20.160 <= sec <= 20.169:
            winners += 1
    return winners

def phone_exists(ws, phone_norm: str) -> bool:
    values = read_all_rows(ws)
    for row in values[1:] if len(values) > 0 else []:
        if len(row) < 3:
            continue
        if normalize_phone(row[2]) == phone_norm and phone_norm != "":
            return True
    return False

def append_entry(ws, name, phone, lang, seconds, shared_bool):
    now_str = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    ws.append_row([now_str, name, phone, lang, f"{seconds:.3f}", str(bool(shared_bool))])

# =========================================================
# 6) ì„¸ì…˜ ìƒíƒœ
# =========================================================
if "lang" not in st.session_state:
    st.session_state.lang = "ko"
if "name" not in st.session_state:
    st.session_state.name = ""
if "y" not in st.session_state:
    st.session_state.y = 2005
if "m" not in st.session_state:
    st.session_state.m = 1
if "d" not in st.session_state:
    st.session_state.d = 1

if "stage" not in st.session_state:
    st.session_state.stage = "input"   # input / result
if "mbti" not in st.session_state:
    st.session_state.mbti = None
if "mbti_mode" not in st.session_state:
    st.session_state.mbti_mode = "direct"

if "shared" not in st.session_state:
    st.session_state.shared = False
if "attempts_used" not in st.session_state:
    st.session_state.attempts_used = 0
if "max_attempts" not in st.session_state:
    st.session_state.max_attempts = 1

if "game_running" not in st.session_state:
    st.session_state.game_running = False
if "start_time" not in st.session_state:
    st.session_state.start_time = None
if "last_time" not in st.session_state:
    st.session_state.last_time = None

if "show_win_form" not in st.session_state:
    st.session_state.show_win_form = False
if "win_seconds" not in st.session_state:
    st.session_state.win_seconds = None

# =========================================================
# 7) ìŠ¤íƒ€ì¼ (ê°€ë…ì„± ê°•í™”)
# =========================================================
st.markdown("""
<style>
.block-container { padding-top: 1.2rem; padding-bottom: 2.5rem; max-width: 720px; }
.card {
  background: rgba(255,255,255,0.96);
  border-radius: 18px;
  padding: 18px 16px;
  box-shadow: 0 10px 28px rgba(0,0,0,0.10);
  border: 1px solid rgba(140,120,200,0.18);
  margin: 12px 0;
}
.header-hero {
  border-radius: 20px;
  padding: 18px 16px;
  background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 50%, #8ec5fc 100%);
  color: white;
  text-align: center;
  box-shadow: 0 12px 30px rgba(0,0,0,0.18);
  margin-bottom: 14px;
}
.hero-title { font-size: 1.5rem; font-weight: 800; margin: 0; }
.hero-sub { font-size: 0.95rem; opacity: 0.95; margin-top: 6px; }
.badge {
  display:inline-block;
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 0.85rem;
  background: rgba(255,255,255,0.20);
  border: 1px solid rgba(255,255,255,0.25);
  margin-top: 10px;
}
.soft-box {
  background: rgba(245,245,255,0.75);
  border: 1px solid rgba(130,95,220,0.18);
  padding: 12px 12px;
  border-radius: 14px;
  line-height: 1.65;
  font-size: 1.0rem;
}
.adbox {
  background: rgba(255,255,255,0.96);
  border-radius: 18px;
  padding: 16px;
  margin: 12px 0;
  border: 2px solid rgba(255, 140, 80, 0.55);
  box-shadow: 0 10px 28px rgba(0,0,0,0.08);
  text-align:center;
}
.adplaceholder {
  background: rgba(255,255,255,0.75);
  border-radius: 18px;
  padding: 14px;
  margin: 12px 0;
  border: 2px dashed rgba(170, 130, 220, 0.55);
  text-align:center;
  color: rgba(60,40,110,0.85);
}
.bigbtn > button {
  border-radius: 999px !important;
  font-weight: 800 !important;
  padding: 0.75rem 1.2rem !important;
}
.small-note {
  font-size: 0.9rem;
  opacity: 0.85;
  text-align:center;
  margin-top: 6px;
}
</style>
""", unsafe_allow_html=True)

# =========================================================
# 8) ì–¸ì–´ ì„ íƒ + SEO ì£¼ì…
# =========================================================
lang_labels = [label for _, label in LANGS]
lang_codes = [code for code, _ in LANGS]
current_idx = lang_codes.index(st.session_state.lang) if st.session_state.lang in lang_codes else 0

picked_label = st.radio(
    T[st.session_state.lang]["lang_pick"],
    lang_labels,
    index=current_idx,
    horizontal=True
)
st.session_state.lang = lang_codes[lang_labels.index(picked_label)]
t = T[st.session_state.lang]

# âœ… ì—¬ê¸°ì„œ SEO ì£¼ì… (UnboundLocalError í•´ê²°ë¨)
inject_seo(st.session_state.lang)

# =========================================================
# 9) ì…ë ¥ í™”ë©´
# =========================================================
def render_input():
    st.markdown(f"""
    <div class="header-hero">
      <p class="hero-title">ğŸ”® {t["title"]}</p>
      <p class="hero-sub">{t["subtitle"]}</p>
      <span class="badge">2026</span>
    </div>
    """, unsafe_allow_html=True)

    st.session_state.name = st.text_input(t["name"], value=st.session_state.name)

    st.markdown(f"<div class='card'><b>{t['birth']}</b></div>", unsafe_allow_html=True)
    c1, c2, c3 = st.columns(3)
    st.session_state.y = c1.number_input(t["year"], 1900, 2030, st.session_state.y, 1)
    st.session_state.m = c2.number_input(t["month"], 1, 12, st.session_state.m, 1)
    st.session_state.d = c3.number_input(t["day"], 1, 31, st.session_state.d, 1)

    mode = st.radio(
        t["mbti_mode"],
        [t["mbti_direct"], t["mbti_12"], t["mbti_16"]],
        index=[t["mbti_direct"], t["mbti_12"], t["mbti_16"]].index(
            t["mbti_direct"] if st.session_state.mbti_mode == "direct" else
            t["mbti_12"] if st.session_state.mbti_mode == "mbti12" else
            t["mbti_16"]
        ),
        key="mbti_mode_radio"
    )
    if mode == t["mbti_direct"]:
        st.session_state.mbti_mode = "direct"
    elif mode == t["mbti_12"]:
        st.session_state.mbti_mode = "mbti12"
    else:
        st.session_state.mbti_mode = "mbti16"

    if st.session_state.mbti_mode == "direct":
        mbti_list = sorted(MBTI_DESC.keys())
        mbti_pick = st.selectbox("MBTI", mbti_list, index=0)
        st.markdown('<div class="bigbtn">', unsafe_allow_html=True)
        if st.button(t["go_result"], use_container_width=True):
            st.session_state.mbti = mbti_pick
            st.session_state.stage = "result"
            st.rerun()
        st.markdown('</div>', unsafe_allow_html=True)

    elif st.session_state.mbti_mode == "mbti12":
        st.markdown(f"<div class='card'><b>MBTI â€“ 12</b><br>{t['mbti_submit']}</div>", unsafe_allow_html=True)
        qlist = MBTI_12_Q.get(st.session_state.lang, MBTI_12_Q["en"])
        score = {"E": 0, "I": 0, "S": 0, "N": 0, "T": 0, "F": 0, "J": 0, "P": 0}

        for idx, (q, opt1, opt2) in enumerate(qlist):
            ans = st.radio(q, [opt1[1], opt2[1]], key=f"mbti12_{idx}", horizontal=True)
            chosen = opt1[0] if ans == opt1[1] else opt2[0]
            score[chosen] += 1

        def pick(a, b):
            return a if score[a] >= score[b] else b

        mbti = pick("E", "I") + pick("S", "N") + pick("T", "F") + pick("J", "P")

        st.markdown('<div class="bigbtn">', unsafe_allow_html=True)
        if st.button(t["go_result"], use_container_width=True):
            st.session_state.mbti = mbti
            st.session_state.stage = "result"
            st.rerun()
        st.markdown('</div>', unsafe_allow_html=True)

    else:  # mbti16
        qpack = MBTI_16_Q.get(st.session_state.lang, MBTI_16_Q["en"])
        st.markdown(f"<div class='card'><b>MBTI â€“ 16</b><br>{t['mbti_submit']}</div>", unsafe_allow_html=True)

        score = {"E": 0, "I": 0, "S": 0, "N": 0, "T": 0, "F": 0, "J": 0, "P": 0}

        def ask_block(title, letter_yes, letter_no, questions, key_prefix):
            st.markdown(f"<div class='card'><b>{title}</b></div>", unsafe_allow_html=True)
            for i, q in enumerate(questions):
                ans = st.radio(
                    f"{i+1}/4  {q}",
                    [qpack["yes"], qpack["no"]],
                    key=f"{key_prefix}_{i}",
                    horizontal=True
                )
                if ans == qpack["yes"]:
                    score[letter_yes] += 1
                else:
                    score[letter_no] += 1

        ask_block("E / I", "E", "I", qpack["E/I"], "ei")
        ask_block("S / N", "S", "N", qpack["S/N"], "sn")
        ask_block("T / F", "T", "F", qpack["T/F"], "tf")
        ask_block("J / P", "J", "P", qpack["J/P"], "jp")

        mbti = ("E" if score["E"] >= score["I"] else "I") + \
               ("S" if score["S"] >= score["N"] else "N") + \
               ("T" if score["T"] >= score["F"] else "F") + \
               ("J" if score["J"] >= score["P"] else "P")

        st.markdown('<div class="bigbtn">', unsafe_allow_html=True)
        if st.button(t["go_result"], use_container_width=True):
            st.session_state.mbti = mbti
            st.session_state.stage = "result"
            st.rerun()
        st.markdown('</div>', unsafe_allow_html=True)

# =========================================================
# 10) ê³µìœ  ë²„íŠ¼ (ëª¨ë°”ì¼ share sheet / PC copy) + ê³µìœ ì‹œ 1íšŒ ì¶”ê°€
# =========================================================
def render_share_button(share_text: str):
    st.markdown('<div class="bigbtn">', unsafe_allow_html=True)
    clicked = st.button(t["share_btn"], use_container_width=True)
    st.markdown('</div>', unsafe_allow_html=True)
    st.caption(t["share_hint"])

    if clicked:
        if not st.session_state.shared:
            st.session_state.shared = True
            st.session_state.max_attempts = 2

        st.components.v1.html(
            f"""
<script>
(async function() {{
  const text = {json.dumps(share_text)};
  try {{
    if (navigator.share) {{
      await navigator.share({{ text }});
    }} else {{
      await navigator.clipboard.writeText(text);
      alert("Copied to clipboard!");
    }}
  }} catch(e) {{
    try {{
      await navigator.clipboard.writeText(text);
      alert("Copied to clipboard!");
    }} catch(_) {{
      alert("Share is not available. Please copy manually.");
    }}
  }}
}})();
</script>
""",
            height=0
        )

# =========================================================
# 11) ê²°ê³¼ í™”ë©´ + ê´‘ê³  + ë¯¸ë‹ˆê²Œì„(í•œêµ­ì–´ë§Œ)
# =========================================================
def render_result():
    y, m, d = st.session_state.y, st.session_state.m, st.session_state.d
    zodiac_key = calc_zodiac_key(y)
    zodiac_label = ZODIAC_LABEL[zodiac_key].get(st.session_state.lang, ZODIAC_LABEL[zodiac_key]["en"])
    zodiac_desc = ZODIAC_TEXT[zodiac_key]["ko"] if st.session_state.lang == "ko" else ZODIAC_TEXT[zodiac_key]["en"]

    mbti = st.session_state.mbti or "ENFP"
    mbti_desc = MBTI_DESC.get(mbti, {"ko": mbti, "en": mbti})
    mbti_line = mbti_desc["ko"] if st.session_state.lang == "ko" else mbti_desc["en"]

    name = (st.session_state.name or "").strip()
    display_name = f"{name}ë‹˜" if (st.session_state.lang == "ko" and name) else (name if name else "")

    saju = get_saju(st.session_state.lang, y, m, d)
    today = seeded_daily(st.session_state.lang, zodiac_key, 0)
    tomorrow = seeded_daily(st.session_state.lang, zodiac_key, 1)
    overall = year_overall(st.session_state.lang, zodiac_key, mbti)

    advice = combo_advice(st.session_state.lang, zodiac_key, mbti)
    advice_lines = advice.splitlines()
    love = advice_lines[0] if len(advice_lines) > 0 else ""
    money = advice_lines[1] if len(advice_lines) > 1 else ""
    work = advice_lines[2] if len(advice_lines) > 2 else ""
    health = advice_lines[3] if len(advice_lines) > 3 else ""

    s = t["sections"]

    st.markdown(f"""
    <div class="header-hero">
      <p class="hero-title">{display_name} {('2026ë…„ ìš´ì„¸' if st.session_state.lang=='ko' else '2026 Fortune')}</p>
      <p class="hero-sub">{zodiac_label} Â· {mbti}</p>
      <span class="badge">{t["best_combo"]}</span>
    </div>
    """, unsafe_allow_html=True)

    # ê²°ê³¼ ìƒë‹¨ ê´‘ê³  ìë¦¬(placeholder)
    st.markdown(f"<div class='adplaceholder'>{t['ad_placeholder']}</div>", unsafe_allow_html=True)

    # ê²°ê³¼ ì¹´ë“œ(HTML íƒœê·¸ ë…¸ì¶œ ë°©ì§€)
    st.markdown("<div class='card'>", unsafe_allow_html=True)
    st.markdown(f"**{s['zodiac']}**: {zodiac_desc}")
    st.markdown(f"**{s['mbti']}**: {mbti_line}")
    st.markdown(f"**{s['saju']}**: {saju}")
    st.markdown("---")
    st.markdown(f"**{s['today']}**: {today}")
    st.markdown(f"**{s['tomorrow']}**: {tomorrow}")
    st.markdown("---")
    st.markdown(f"**{s['year_all']}**: {overall}")
    st.markdown("</div>", unsafe_allow_html=True)

    st.markdown("<div class='card'>", unsafe_allow_html=True)
    st.markdown(f"**{s['love']}**: {love}")
    st.markdown(f"**{s['money']}**: {money}")
    st.markdown(f"**{s['work']}**: {work}")
    st.markdown(f"**{s['health']}**: {health}")
    st.markdown("---")
    st.markdown(f"**{s['point']}**: "
                f"{('ëŸ­í‚¤ ì»¬ëŸ¬' if st.session_state.lang=='ko' else 'Lucky color')} **{random.choice(['Gold','Blue','Green','Purple','Red'])}**, "
                f"{('ëŸ­í‚¤ ì•„ì´í…œ' if st.session_state.lang=='ko' else 'Lucky item')} **{random.choice(['Wallet','Pen','Plant','Notebook','Accessory'])}**")
    st.markdown("</div>", unsafe_allow_html=True)

    # í•œêµ­ì–´ë§Œ ë‹¤ë‚˜ëˆ”ë Œíƒˆ ê´‘ê³  ë…¸ì¶œ
    if st.session_state.lang == "ko":
        st.markdown(f"""
        <div class="adbox">
          <small style="font-weight:800;color:#e74c3c;">ê´‘ê³ </small><br>
          <div style="font-size:1.15rem;font-weight:900;margin-top:6px;">{t["ad_kr_title"]}</div>
          <div style="margin-top:6px;">{t["ad_kr_body1"]}</div>
          <div>{t["ad_kr_body2"]}</div>
          <div style="margin-top:10px;">
            <a href="{t["ad_kr_url"]}" target="_blank"
               style="display:inline-block;background:#ff8c50;color:white;
               padding:10px 16px;border-radius:999px;font-weight:900;text-decoration:none;">
              {t["ad_kr_link"]}
            </a>
          </div>
        </div>
        """, unsafe_allow_html=True)

    # íƒ€ë¡œ
    if st.button(t["tarot_btn"], use_container_width=True):
        k, meaning = pick_tarot(st.session_state.lang)
        st.markdown(f"""
        <div class="card" style="text-align:center;">
          <div style="font-weight:900;color:#6b4fd6;">{t["tarot_title"]}</div>
          <div style="font-size:1.6rem;font-weight:900;margin-top:6px;">{k}</div>
          <div style="margin-top:8px;" class="soft-box">{meaning}</div>
        </div>
        """, unsafe_allow_html=True)

    # ê³µìœ  í…ìŠ¤íŠ¸
    share_text = (
        f"{display_name} 2026 Fortune\n"
        f"{zodiac_label} + {mbti}\n\n"
        f"{s['today']}: {today}\n"
        f"{s['tomorrow']}: {tomorrow}\n\n"
        f"{s['year_all']}: {overall}\n\n"
        f"{s['advice']}:\n{advice}\n\n"
        f"{APP_URL}"
    )
    render_share_button(share_text)

    # ë¯¸ë‹ˆê²Œì„ (í•œêµ­ì–´ë§Œ)
    if st.session_state.lang == "ko":
        st.markdown(
            f"<div class='card'><div style='font-weight:900;font-size:1.2rem;'>{t['mini_title']}</div>"
            f"<div style='margin-top:8px;' class='soft-box'>{t['mini_desc']}</div></div>",
            unsafe_allow_html=True
        )

        ws = get_sheet()
        sheet_ready = ws is not None
        if not sheet_ready:
            st.warning(t["sheet_fail"])
        else:
            st.success(t["sheet_ok"])

        closed = False
        if sheet_ready:
            try:
                if count_winners(ws) >= 20:
                    closed = True
            except Exception:
                closed = False

        tries_left = max(0, st.session_state.max_attempts - st.session_state.attempts_used)
        st.markdown(f"<div class='small-note'>{t['mini_try_left']}: <b>{tries_left}</b> / {st.session_state.max_attempts}</div>",
                    unsafe_allow_html=True)

        if closed:
            st.info(t["mini_closed"])
        else:
            colA, colB = st.columns(2)

            with colA:
                if st.button(t["mini_start"], use_container_width=True):
                    if tries_left <= 0:
                        st.warning("ë‚¨ì€ ì‹œë„ê°€ ì—†ìŠµë‹ˆë‹¤.")
                    else:
                        st.session_state.game_running = True
                        st.session_state.start_time = time.monotonic()
                        st.session_state.last_time = None

            with colB:
                if st.button(t["mini_stop"], use_container_width=True):
                    if not st.session_state.game_running or st.session_state.start_time is None:
                        st.warning(t["mini_need_start"])
                    else:
                        elapsed = time.monotonic() - st.session_state.start_time
                        st.session_state.game_running = False
                        st.session_state.last_time = elapsed
                        st.session_state.attempts_used += 1

                        st.markdown(f"<div class='card'><b>{t['mini_result']}</b>: {elapsed:.3f}s</div>", unsafe_allow_html=True)

                        if 20.160 <= elapsed <= 20.169:
                            st.session_state.show_win_form = True
                            st.session_state.win_seconds = elapsed
                        else:
                            st.info("ì•„ì‰½ê²Œë„ ë¯¸ë‹¬/ì´ˆê³¼! ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš” ğŸ™‚")

            if st.session_state.game_running and st.session_state.start_time is not None:
                now_elapsed = time.monotonic() - st.session_state.start_time
                st.markdown(f"<div class='small-note'>â±ï¸ ì§„í–‰ ì¤‘â€¦ í˜„ì¬ {now_elapsed:.3f}s</div>", unsafe_allow_html=True)

            if st.session_state.show_win_form and st.session_state.win_seconds is not None:
                st.markdown("<div class='card'>", unsafe_allow_html=True)
                st.markdown(f"### {t['win_title']}")
                st.markdown(f"**ê¸°ë¡:** {st.session_state.win_seconds:.3f}s")

                nm = st.text_input(t["win_name"], value=(st.session_state.name or "").strip(), key="win_name_input")
                ph = st.text_input(t["win_phone"], value="", key="win_phone_input")
                ph_norm = normalize_phone(ph)

                consent = st.checkbox(f"{t['win_consent']}  \n{t['win_consent_text']}", value=False, key="consent_chk")

                if st.button(t["win_submit"], use_container_width=True):
                    if not sheet_ready:
                        st.error(t["sheet_fail"])
                    elif not consent:
                        st.warning("ë™ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.")
                    elif nm.strip() == "" or ph_norm == "":
                        st.warning("ì´ë¦„/ì „í™”ë²ˆí˜¸ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.")
                    else:
                        try:
                            if phone_exists(ws, ph_norm):
                                st.warning(t["mini_dup"])
                            else:
                                if count_winners(ws) >= 20:
                                    st.info(t["mini_closed"])
                                else:
                                    append_entry(ws, nm.strip(), ph_norm, st.session_state.lang,
                                                 float(st.session_state.win_seconds), st.session_state.shared)
                                    st.success(t["win_thanks"])
                                    st.session_state.show_win_form = False
                                    st.session_state.win_seconds = None
                        except Exception as e:
                            st.error(f"ì €ì¥ ì¤‘ ì˜¤ë¥˜: {e}")

                st.markdown("</div>", unsafe_allow_html=True)

    # ê²°ê³¼ í™”ë©´ì—ë§Œ "ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°"(ì…ë ¥ í™”ë©´ í•˜ë‹¨ ë²„íŠ¼ì€ ì—†ìŒ)
    if st.button(t["reset"], use_container_width=True):
        st.session_state.clear()
        st.rerun()

    st.caption(APP_URL)

# =========================================================
# 12) ë¼ìš°íŒ…
# =========================================================
if st.session_state.stage == "input":
    render_input()
else:
    render_result()
