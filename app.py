import streamlit as st
from datetime import datetime, timedelta, date
import random
import json
from pathlib import Path
import streamlit.components.v1 as components


# =========================================
# 0) ์ธ์ด ์ค์ (6๊ฐ)
# =========================================
LANG_OPTIONS = {
    "ko": "ํ๊ตญ์ด",
    "en": "English",
    "hi": "เคนเคฟเคจเฅเคฆเฅ",
    "zh": "ไธญๆ(็ฎไฝ)",
    "ru": "ะัััะบะธะน",
    "ja": "ๆฅๆฌ่ช"
}

UI = {
    "ko": {
        "title": "โญ 2026๋ ์ด์ธ โญ",
        "subtitle": "๋ + MBTI + ์ฌ์ฃผ + ์ค๋/๋ด์ผ ์ด์ธ",
        "lang_label": "์ธ์ด / Language",
        "name_label": "์ด๋ฆ ์๋ฅ (๊ฒฐ๊ณผ์ ํ์๋ผ์)",
        "birth_label": "์๋์์ผ ์๋ฅ",
        "mbti_mode": "MBTI๋ ์ด๋ป๊ฒ ํ๊น์?",
        "mbti_direct": "์ง์ ์ํ(์ด๋ฏธ ์์์)",
        "mbti_test": "๊ฐ๋จ ํ์คํธ(12๋ฌธํญ)",
        "btn_view": "2026๋ ์ด์ธ ๋ณด๊ธฐ!",
        "btn_view_test": "ํ์คํธ ๊ฒฐ๊ณผ๋ก ์ด์ธ ๋ณด๊ธฐ!",
        "combo": "์ต๊ณ ์กฐํฉ!",
        "zodiac_title": "๋ ์ด์ธ",
        "mbti_title": "MBTI ํน์ง",
        "saju_title": "์ฌ์ฃผ ํ ๋ง๋",
        "today_title": "์ค๋ ์ด์ธ",
        "tomorrow_title": "๋ด์ผ ์ด์ธ",
        "overall_title": "2026 ์์ฒด ์ด์ธ",
        "combo_title": "์กฐํฉ ํ ๋ง๋",
        "lucky_color_title": "๋ญํค ์ปฌ๋ฌ",
        "lucky_item_title": "๋ญํค ์์ดํ",
        "tip_title": "ํ",
        "tarot_btn": "์ค๋์ ํ๋ก ์นด๋ ๋ณด๊ธฐ",
        "tarot_title": "์ค๋์ ํ๋ก ์นด๋",
        "share_btn": "์น๊ตฌ์๊ฒ ๊ณต์ํ๊ธฐ",
        "reset_btn": "์ฒ์๋ถํฐ ๋ค์ํ๊ธฐ",
        "error_year": "์๋์ 1900~2030๋ ์ฌ์ด๋ก ์๋ฅํด์ฃผ์ธ์!",
        "test_caption": "์ด 12๋ฌธํญ(์ฝ 30์ด) โ ์์งํ๊ฒ ๊ณ๋ฅด๋ฉด ๋ ์ ๋ง์์ ๐",
        "sec_ei": "1) ์๋์ง(E/I)",
        "sec_sn": "2) ์ธ์(S/N)",
        "sec_tf": "3) ํ๋จ(T/F)",
        "sec_jp": "4) ์ํ(J/P)",
        "share_title": "2026๋ ์ด์ธ",
        "share_fail_copy": "๊ณต์ ๊ธฐ๋ฅ์ด ์ง์๋์ง ์์ ํ์คํธ๋ฅผ ๋ณต์ฌํ์ด์!\n์นดํก์ ๋ถ์ฌ๋ฃ๊ธฐ ํด์ฃผ์ธ์.",
        "share_manual_prompt": "์๋ ๋ด์ฉ์ ๋ณต์ฌํด์ ์นดํก์ ๋ถ์ฌ๋ฃ๊ธฐ ํด์ฃผ์ธ์:",
        "share_cancel": "๊ณต์๊ฐ ์ทจ์๋์๊ฑฐ๋ ์ง์๋์ง ์์์.\n๋ณต์ฌ ํ ๋ถ์ฌ๋ฃ๊ธฐ ํด์ฃผ์ธ์.",
        "db_tools_title": "๐ฆ (์ด๋ณด์ฉ) ์ด์ธ DB ํ์ผ ๋ง๋ค๊ธฐ/๋ค์ด๋ก๋",
        "db_tools_desc": "์ง๊ธ ๋ณด์ด๋ ๊ฒฐ๊ณผ ๋ฌธ์ฅ๋ค์ 'DB(JSON ํ์ผ)'๋ก ์์ฅํด์ GitHub์ ์ฌ๋ฆด ์ ์์ด์.",
        "download_db_btn": "์ด ์ธ์ด DB(JSON) ๋ค์ด๋ก๋",
        "db_path_hint": "๋ค์ด๋ฐ์ ํ์ผ์ GitHub์ data/fortunes_{lang}.json ์ผ๋ก ์๋ก๋ํ๋ฉด '์ง์ง DB ๊ธฐ๋ฐ'์ผ๋ก ๋์ํด์."
    },
    "en": {
        "title": "โญ 2026 Fortune โญ",
        "subtitle": "Zodiac + MBTI + Fortune + Today/Tomorrow Luck",
        "lang_label": "Language / ์ธ์ด",
        "name_label": "Name (shown in result)",
        "birth_label": "Birth date",
        "mbti_mode": "How to do MBTI?",
        "mbti_direct": "Select directly (I know it)",
        "mbti_test": "Quick test (12 questions)",
        "btn_view": "See my 2026 fortune!",
        "btn_view_test": "See fortune from test result!",
        "combo": "Best Combo!",
        "zodiac_title": "Zodiac fortune",
        "mbti_title": "MBTI traits",
        "saju_title": "Fortune comment",
        "today_title": "Today's luck",
        "tomorrow_title": "Tomorrow's luck",
        "overall_title": "2026 annual luck",
        "combo_title": "Combination meaning",
        "lucky_color_title": "Lucky color",
        "lucky_item_title": "Lucky item",
        "tip_title": "Tip",
        "tarot_btn": "Draw today's tarot card",
        "tarot_title": "Today's tarot card",
        "share_btn": "Share with friends",
        "reset_btn": "Start over",
        "error_year": "Please enter a birth year between 1900 and 2030!",
        "test_caption": "12 questions (~30 sec) โ answer honestly ๐",
        "sec_ei": "1) Energy (E/I)",
        "sec_sn": "2) Perception (S/N)",
        "sec_tf": "3) Decision (T/F)",
        "sec_jp": "4) Lifestyle (J/P)",
        "share_title": "2026 Fortune",
        "share_fail_copy": "Sharing isn't supported here, so the text was copied.\nPaste it in KakaoTalk or message.",
        "share_manual_prompt": "Copy and paste this text to share:",
        "share_cancel": "Sharing was canceled or not supported.\nPlease copy & paste.",
        "db_tools_title": "๐ฆ DB generator/download",
        "db_tools_desc": "You can download the fortune DB (JSON) and upload it to GitHub.",
        "download_db_btn": "Download DB(JSON) for this language",
        "db_path_hint": "Upload the file to GitHub as data/fortunes_{lang}.json to run with a real DB."
    },
    "hi": {
        "title": "โญ 2026 เคญเคพเคเฅเคฏ โญ",
        "subtitle": "Zodiac + MBTI + Fortune + Today/Tomorrow Luck",
        "lang_label": "Language / เคญเคพเคทเคพ",
        "name_label": "เคจเคพเคฎ (เคชเคฐเคฟเคฃเคพเคฎ เคฎเฅเค เคฆเคฟเคเฅเคเคพ)",
        "birth_label": "เคเคจเฅเคฎ เคคเคฟเคฅเคฟ",
        "mbti_mode": "MBTI เคเฅเคธเฅ เคเคฐเฅเค?",
        "mbti_direct": "เคธเฅเคงเคพ เคเฅเคจเฅเค",
        "mbti_test": "เคคเฅเคตเคฐเคฟเคค เคเฅเคธเฅเค (12 เคชเฅเคฐเคถเฅเคจ)",
        "btn_view": "2026 เคญเคพเคเฅเคฏ เคฆเฅเคเฅเค!",
        "btn_view_test": "เคเฅเคธเฅเค เคเฅ เคธเคพเคฅ เคฆเฅเคเฅเค!",
        "combo": "Best Combo!",
        "zodiac_title": "Zodiac fortune",
        "mbti_title": "MBTI traits",
        "saju_title": "Fortune comment",
        "today_title": "Today's luck",
        "tomorrow_title": "Tomorrow's luck",
        "overall_title": "2026 annual luck",
        "combo_title": "Combination meaning",
        "lucky_color_title": "Lucky color",
        "lucky_item_title": "Lucky item",
        "tip_title": "Tip",
        "tarot_btn": "เคเค เคเคพ เคเฅเคฐเฅ เคเคพเคฐเฅเคก",
        "tarot_title": "เคเค เคเคพ เคเฅเคฐเฅ",
        "share_btn": "Share with friends",
        "reset_btn": "Start over",
        "error_year": "1900โ2030 เคเฅ เคฌเฅเค เคเคจเฅเคฎ เคตเคฐเฅเคท เคฆเคฐเฅเค เคเคฐเฅเค!",
        "test_caption": "12 เคชเฅเคฐเคถเฅเคจ (~30 เคธเฅเคเคเคก) โ เคเคฎเคพเคจเคฆเคพเคฐเฅ เคธเฅ เคเฅเคจเฅเค ๐",
        "sec_ei": "1) Energy (E/I)",
        "sec_sn": "2) Perception (S/N)",
        "sec_tf": "3) Decision (T/F)",
        "sec_jp": "4) Lifestyle (J/P)",
        "share_title": "2026 Fortune",
        "share_fail_copy": "Sharing is not supported here, so the text was copied.\nPlease paste it in your messenger.",
        "share_manual_prompt": "Copy and paste this text:",
        "share_cancel": "Sharing canceled or not supported.\nPlease copy & paste.",
        "db_tools_title": "๐ฆ DB เคกเคพเคเคจเคฒเฅเคก",
        "db_tools_desc": "DB(JSON) เคกเคพเคเคจเคฒเฅเคก เคเคฐเคเฅ GitHub เคชเคฐ เคเคชเคฒเฅเคก เคเคฐ เคธเคเคคเฅ เคนเฅเคเฅค",
        "download_db_btn": "เคเคธ เคญเคพเคทเคพ เคเคพ DB(JSON) เคกเคพเคเคจเคฒเฅเคก",
        "db_path_hint": "GitHub เคฎเฅเค data/fortunes_{lang}.json เคเฅ เคฐเฅเคช เคฎเฅเค เคเคชเคฒเฅเคก เคเคฐเฅเคเฅค"
    },
    "zh": {
        "title": "โญ 2026 ่ฟๅฟ โญ",
        "subtitle": "็่ + MBTI + ไปๆฅ/ๆๆฅ่ฟๅฟ",
        "lang_label": "่ฏญ่จ / Language",
        "name_label": "ๅงๅ๏ผๆพ็คบๅจ็ปๆ๏ผ",
        "birth_label": "ๅบ็ๆฅๆ",
        "mbti_mode": "MBTI ๆไนๅ๏ผ",
        "mbti_direct": "็ดๆฅ้ๆฉ",
        "mbti_test": "ๅฟซ้ๆต่ฏ๏ผ12้ข๏ผ",
        "btn_view": "ๆฅ็ 2026 ่ฟๅฟ๏ผ",
        "btn_view_test": "็จๆต่ฏ็ปๆๆฅ็๏ผ",
        "combo": "ๆไฝณ็ปๅ๏ผ",
        "zodiac_title": "็่่ฟๅฟ",
        "mbti_title": "MBTI ็น็น",
        "saju_title": "ไธๅฅ่ฏ่ฟๅฟ",
        "today_title": "ไปๆฅ่ฟๅฟ",
        "tomorrow_title": "ๆๆฅ่ฟๅฟ",
        "overall_title": "2026 ๅจๅนด่ฟๅฟ",
        "combo_title": "็ปๅไธๅฅ่ฏ",
        "lucky_color_title": "ๅนธ่ฟ้ข่ฒ",
        "lucky_item_title": "ๅนธ่ฟ็ฉๅ",
        "tip_title": "ๆ็คบ",
        "tarot_btn": "ๆฝไปๆฅๅก็ฝ็",
        "tarot_title": "ไปๆฅๅก็ฝ",
        "share_btn": "ๅไบซ็ปๆๅ",
        "reset_btn": "้ๆฐๅผๅง",
        "error_year": "่ฏท่พๅฅ 1900โ2030 ไน้ด็ๅบ็ๅนดไปฝ๏ผ",
        "test_caption": "12้ข๏ผ็บฆ30็ง๏ผโ ็่ฏไฝ็ญๆดๅ ๐",
        "sec_ei": "1) Energy (E/I)",
        "sec_sn": "2) Perception (S/N)",
        "sec_tf": "3) Decision (T/F)",
        "sec_jp": "4) Lifestyle (J/P)",
        "share_title": "2026 ่ฟๅฟ",
        "share_fail_copy": "ๅฝๅ็ฏๅขไธๆฏๆๅไบซ๏ผๅทฒๅคๅถๆๆฌใ\n่ฏท็ฒ่ดดๅฐ่ๅคฉ่ฝฏไปถๅ้ใ",
        "share_manual_prompt": "ๅคๅถๅนถ็ฒ่ดดไปฅไธๅๅฎน๏ผ",
        "share_cancel": "ๅไบซๅๆถๆไธๆฏๆใ\n่ฏทๅคๅถๅนถ็ฒ่ดดใ",
        "db_tools_title": "๐ฆ ็ๆ/ไธ่ฝฝ DB",
        "db_tools_desc": "ๅฏไปฅไธ่ฝฝ DB(JSON) ไธไผๅฐ GitHubใ",
        "download_db_btn": "ไธ่ฝฝ่ฏฅ่ฏญ่จ DB(JSON)",
        "db_path_hint": "ไธไผๅฐ GitHub๏ผdata/fortunes_{lang}.json"
    },
    "ru": {
        "title": "โญ 2026 ะฃะดะฐัะฐ โญ",
        "subtitle": "Zodiac + MBTI + Today/Tomorrow Luck",
        "lang_label": "ะฏะทัะบ / Language",
        "name_label": "ะะผั (ะฒ ัะตะทัะปััะฐัะต)",
        "birth_label": "ะะฐัะฐ ัะพะถะดะตะฝะธั",
        "mbti_mode": "ะะฐะบ ะฒัะฑัะฐัั MBTI?",
        "mbti_direct": "ะัะฑัะฐัั ะฝะฐะฟััะผัั",
        "mbti_test": "ะัััััะน ัะตัั (12 ะฒะพะฟัะพัะพะฒ)",
        "btn_view": "ะะพะบะฐะทะฐัั ัะดะฐัั 2026!",
        "btn_view_test": "ะะพะบะฐะทะฐัั ะฟะพ ัะตััั!",
        "combo": "ะัััะตะต ัะพัะตัะฐะฝะธะต!",
        "zodiac_title": "Zodiac",
        "mbti_title": "MBTI",
        "saju_title": "ะะพะผะผะตะฝัะฐัะธะน",
        "today_title": "ะกะตะณะพะดะฝั",
        "tomorrow_title": "ะะฐะฒััะฐ",
        "overall_title": "2026 ะณะพะด",
        "combo_title": "ะกะพัะตัะฐะฝะธะต",
        "lucky_color_title": "ะฆะฒะตั",
        "lucky_item_title": "ะัะตะดะผะตั",
        "tip_title": "ะกะพะฒะตั",
        "tarot_btn": "ะขะฐัะพ ะดะฝั",
        "tarot_title": "ะขะฐัะพ",
        "share_btn": "ะะพะดะตะปะธัััั",
        "reset_btn": "ะกะฝะฐัะฐะปะฐ",
        "error_year": "ะะฒะตะดะธัะต ะณะพะด ัะพะถะดะตะฝะธั 1900โ2030!",
        "test_caption": "12 ะฒะพะฟัะพัะพะฒ (~30 ัะตะบ) โ ะพัะฒะตัะฐะนัะต ัะตััะฝะพ ๐",
        "sec_ei": "1) Energy (E/I)",
        "sec_sn": "2) Perception (S/N)",
        "sec_tf": "3) Decision (T/F)",
        "sec_jp": "4) Lifestyle (J/P)",
        "share_title": "2026 Fortune",
        "share_fail_copy": "Sharing isn't supported here, so the text was copied.\nPlease paste it in messenger.",
        "share_manual_prompt": "Copy and paste this text:",
        "share_cancel": "Sharing canceled or not supported.\nPlease copy & paste.",
        "db_tools_title": "๐ฆ ะกะบะฐัะฐัั DB",
        "db_tools_desc": "ะกะบะฐัะฐะนัะต DB(JSON) ะธ ะทะฐะณััะทะธัะต ะฒ GitHub.",
        "download_db_btn": "ะกะบะฐัะฐัั DB(JSON) ะดะปั ัะทัะบะฐ",
        "db_path_hint": "ะะฐะณััะทะธัะต ะบะฐะบ data/fortunes_{lang}.json"
    },
    "ja": {
        "title": "โญ 2026 ้ๅข โญ",
        "subtitle": "ๅนฒๆฏ + MBTI + ไปๆฅ/ๆๆฅใฎ้ๅข",
        "lang_label": "่จ่ช / Language",
        "name_label": "ๅๅ๏ผ็ตๆใซ่กจ็คบ๏ผ",
        "birth_label": "็ๅนดๆๆฅ",
        "mbti_mode": "MBTI ใฏใฉใใใ๏ผ",
        "mbti_direct": "็ดๆฅ้ธใถ",
        "mbti_test": "ใฏใคใใฏใในใ๏ผ12ๅ๏ผ",
        "btn_view": "2026้ๅขใ่ฆใ๏ผ",
        "btn_view_test": "ใในใ็ตๆใง่ฆใ๏ผ",
        "combo": "ๆ้ซใฎ็ตใฟๅใใ๏ผ",
        "zodiac_title": "ๅนฒๆฏ้ๅข",
        "mbti_title": "MBTI็นๅพด",
        "saju_title": "ใฒใจ่จ",
        "today_title": "ไปๆฅ",
        "tomorrow_title": "ๆๆฅ",
        "overall_title": "2026ๅจไฝ้",
        "combo_title": "็ตใฟๅใใ",
        "lucky_color_title": "ใฉใใญใผใซใฉใผ",
        "lucky_item_title": "ใฉใใญใผใขใคใใ",
        "tip_title": "ใใณใ",
        "tarot_btn": "ไปๆฅใฎใฟใญใใ",
        "tarot_title": "ใฟใญใใ",
        "share_btn": "ๅ้ใซๅฑๆ",
        "reset_btn": "ๆๅใใ",
        "error_year": "1900ใ2030ใฎๅนดใๅฅๅใใฆใใใใ๏ผ",
        "test_caption": "12ๅ๏ผ็ด30็ง๏ผโ ็ด็ดใซ้ธใถใจๅฝใใใใใ๐",
        "sec_ei": "1) Energy (E/I)",
        "sec_sn": "2) Perception (S/N)",
        "sec_tf": "3) Decision (T/F)",
        "sec_jp": "4) Lifestyle (J/P)",
        "share_title": "2026้ๅข",
        "share_fail_copy": "ๅฑๆใไฝฟใใชใใใใใญในใใใณใใผใใพใใใ\nใกใใปใณใธใฃใผใซ่ฒผใไปใใฆใใใใใ",
        "share_manual_prompt": "ไปฅไธใใณใใผใใฆ่ฒผใไปใใฆใใใใ๏ผ",
        "share_cancel": "ๅฑๆใใญใฃใณใปใซ/้ๅฏพๅฟใงใใ\nใณใใผใใฆ่ฒผใไปใใฆใใใใใ",
        "db_tools_title": "๐ฆ DBใใฆใณใญใผใ",
        "db_tools_desc": "DB(JSON)ใใใฆใณใญใผใใใฆGitHubใซใขใใใงใใพใใ",
        "download_db_btn": "ใใฎ่จ่ชใฎDB(JSON)ใใใฆใณใญใผใ",
        "db_path_hint": "GitHubใฎ data/fortunes_{lang}.json ใจใใฆใขใใใญใผใ"
    }
}


# =========================================
# 1) ๊ธฐ๋ณธ ๋ฐ์ดํฐ: ๋/MBTI/ํ๋ก/์ฌ์ฃผ
# =========================================
ZODIAC_LIST = {
    "ko": ["์ฅ๋","์๋","ํธ๋์ด๋","ํ๋ผ๋","์ฉ๋","๋ฑ๋","๋ง๋","์๋","์์ญ์ด๋","๋ญ๋","๊ฐ๋","๋ผ์ง๋"],
    "en": ["Rat","Ox","Tiger","Rabbit","Dragon","Snake","Horse","Goat","Monkey","Rooster","Dog","Pig"],
    "hi": ["Rat","Ox","Tiger","Rabbit","Dragon","Snake","Horse","Goat","Monkey","Rooster","Dog","Pig"],
    "zh": ["้ผ","็","่","ๅ","้พ","่","้ฉฌ","็พ","็ด","้ธก","็","็ช"],
    "ru": ["Rat","Ox","Tiger","Rabbit","Dragon","Snake","Horse","Goat","Monkey","Rooster","Dog","Pig"],
    "ja": ["ๅญ","ไธ","ๅฏ","ๅฏ","่พฐ","ๅทณ","ๅ","ๆช","็ณ","้","ๆ","ไบฅ"]
}

MBTIS = {
    "ko": {
        "INTJ":"๋์ฒ ์๋ต๊ฐ","INTP":"์์ด๋์ด ์ฒ์ฌ","ENTJ":"๋ณด์ค","ENTP":"ํ๋ก์",
        "INFJ":"๋ง์ ๋ง์คํฐ","INFP":"๊ฐ์ฑ ์์๊ฐ","ENFJ":"๋ชจ๋ ์์๋","ENFP":"์ธ๊ฐ ๋นํ๋ฏผ",
        "ISTJ":"๊ท์น ์งํด์ด","ISFJ":"์ธ์ ๋ฐ๋ปํจ","ESTJ":"๋ฆฌ๋","ESFJ":"๋ถ์๊ธฐ ๋ฉ์ด์ปค",
        "ISTP":"๊ณ์น๋ ์ฅ์ธ","ISFP":"๊ฐ์ฑ ํ๋ฌ","ESTP":"๋ชจํ์","ESFP":"ํํฐ ์ฃผ์ธ๊ณต"
    },
    "en": {
        "INTJ":"Strategist","INTP":"Thinker","ENTJ":"Commander","ENTP":"Debater",
        "INFJ":"Advocate","INFP":"Mediator","ENFJ":"Protagonist","ENFP":"Campaigner",
        "ISTJ":"Logistician","ISFJ":"Defender","ESTJ":"Executive","ESFJ":"Consul",
        "ISTP":"Virtuoso","ISFP":"Adventurer","ESTP":"Entrepreneur","ESFP":"Entertainer"
    },
    "hi": {
        "INTJ":"Strategist","INTP":"Thinker","ENTJ":"Commander","ENTP":"Debater",
        "INFJ":"Advocate","INFP":"Mediator","ENFJ":"Protagonist","ENFP":"Campaigner",
        "ISTJ":"Logistician","ISFJ":"Defender","ESTJ":"Executive","ESFJ":"Consul",
        "ISTP":"Virtuoso","ISFP":"Adventurer","ESTP":"Entrepreneur","ESFP":"Entertainer"
    },
    "zh": {
        "INTJ":"ๆ็ฅๅฎถ","INTP":"ๆ่่","ENTJ":"ๆๆฅๅฎ","ENTP":"่พฉ่ฎบๅฎถ",
        "INFJ":"ๆๅก่","INFP":"่ฐๅ่","ENFJ":"ไธปไบบๅฌ","ENFP":"็ซ้่",
        "ISTJ":"็ฉๆตๅธ","ISFJ":"ๅฎๆค่","ESTJ":"ๆป็ป็","ESFJ":"ๆงๆฟๅฎ",
        "ISTP":"้ด่ตๅฎถ","ISFP":"ๆข้ฉๅฎถ","ESTP":"ไผไธๅฎถ","ESFP":"่กจๆผ่"
    },
    "ru": {
        "INTJ":"Strategist","INTP":"Thinker","ENTJ":"Commander","ENTP":"Debater",
        "INFJ":"Advocate","INFP":"Mediator","ENFJ":"Protagonist","ENFP":"Campaigner",
        "ISTJ":"Logistician","ISFJ":"Defender","ESTJ":"Executive","ESFJ":"Consul",
        "ISTP":"Virtuoso","ISFP":"Adventurer","ESTP":"Entrepreneur","ESFP":"Entertainer"
    },
    "ja": {
        "INTJ":"Strategist","INTP":"Thinker","ENTJ":"Commander","ENTP":"Debater",
        "INFJ":"Advocate","INFP":"Mediator","ENFJ":"Protagonist","ENFP":"Campaigner",
        "ISTJ":"Logistician","ISFJ":"Defender","ESTJ":"Executive","ESFJ":"Consul",
        "ISTP":"Virtuoso","ISFP":"Adventurer","ESTP":"Entrepreneur","ESFP":"Entertainer"
    }
}

SAJU_MSGS = {
    "ko": ["๋ชฉ(ๆจ) ๊ธฐ์ด ๊ฐํจ โ ์ฑ์ฅ๊ณผ ๋ฐ์์ ํด!","ํ(็ซ) ๊ธฐ์ด ๊ฐํจ โ ์ด์ ํญ๋ฐ!","ํ(ๅ) ๊ธฐ์ด ๊ฐํจ โ ์์๊ณผ ์ฌ๋ฌผ์ด","๊ธ(้) ๊ธฐ์ด ๊ฐํจ โ ๊ฒฐ๋จ๋ฅ ์ข์!","์(ๆฐด) ๊ธฐ์ด ๊ฐํจ โ ์งํ์ ํ๋ฆ","์คํ ๊ทํ โ ํ๋ณตํ ํ ํด","์๊ธฐ ๊ฐํจ โ ๋์ ์ฑ๊ณต","์๊ธฐ ๊ฐํจ โ ๋ด๋ฉด ์ฑ์ฐฐ"],
    "en": ["Strong Wood โ A year of growth!","Strong Fire โ Passion explodes!","Strong Earth โ Stability & wealth","Strong Metal โ Decisive energy!","Strong Water โ Wisdom & flow","Balanced elements โ Happy year","Strong Yang โ Challenge & success","Strong Yin โ Inner reflection"],
    "hi": ["Strong Wood โ A year of growth!","Strong Fire โ Passion explodes!","Strong Earth โ Stability & wealth","Strong Metal โ Decisive energy!","Strong Water โ Wisdom & flow","Balanced elements โ Happy year","Strong Yang โ Challenge & success","Strong Yin โ Inner reflection"],
    "zh": ["ๆจๆบ๏ผๆ้ฟไนๅนด","็ซๆบ๏ผ็ญๆ็ๅ","ๅๆบ๏ผ็จณๅฎไธ่ดข่ฟ","้ๆบ๏ผๆๆญๆๅ","ๆฐดๆบ๏ผๆบๆงไธ้กบๆต","ไบ่กๅนณ่กก๏ผๅนธ็ฆไนๅนด","้ณๆฐๅผบ๏ผๆๆๆๅ","้ดๆฐๅผบ๏ผๅ็ๆ้ฟ"],
    "ru": ["Strong Wood โ A year of growth!","Strong Fire โ Passion explodes!","Strong Earth โ Stability & wealth","Strong Metal โ Decisive energy!","Strong Water โ Wisdom & flow","Balanced elements โ Happy year","Strong Yang โ Challenge & success","Strong Yin โ Inner reflection"],
    "ja": ["ๆจใๅผทใโๆ้ทใฎๅนด","็ซใๅผทใโๆ็ฑใฎๅนด","ๅใๅผทใโๅฎๅฎใจ้้","้ใๅผทใโๆฑบๆญๅ","ๆฐดใๅผทใโ็ฅๆตใจๆตใ","ใใฉใณในโๅนธ็ฆใฎๅนด","้ฝใๅผทใโๆๆฆๆๅ","้ฐใๅผทใโๅ็"]
}

TAROT_CARDS = {
    "The Fool": {"ko":"๋ฐ๋ณด - ์๋ก์ด ์์, ๋ชจํ","en":"New beginnings, adventure","hi":"New beginnings, adventure","zh":"ๆฐ็ๅผๅงใๅ้ฉ","ru":"New beginnings, adventure","ja":"ๆฐใใๅงใพใใปๅ้บ"},
    "The Magician": {"ko":"๋ง๋ฒ์ฌ - ์ง์ค, ๋ฅ๋ฅ ๋ฐํ","en":"Skill, focus","hi":"Skill, focus","zh":"ไธๆณจไธ่ฝๅ","ru":"Skill, focus","ja":"้ไธญใจๅฎ็พๅ"},
    "The High Priestess": {"ko":"์ฌ์ฌ์ - ์ง๊ฐ, ๋ด๋ฉด","en":"Intuition, inner voice","hi":"Intuition, inner voice","zh":"็ด่งไธๅๅจ","ru":"Intuition, inner voice","ja":"็ดๆใจๅ้ข"},
    "The Empress": {"ko":"์ฌ์ - ํ์, ์ฐฝ์","en":"Abundance, creativity","hi":"Abundance, creativity","zh":"ไธฐ็ไธๅ้","ru":"Abundance, creativity","ja":"่ฑใใใปๅต้"},
    "The Emperor": {"ko":"ํฉ์ - ์์, ๊ตฌ์กฐ","en":"Stability, structure","hi":"Stability, structure","zh":"็จณๅฎไธ็งฉๅบ","ru":"Stability, structure","ja":"ๅฎๅฎใป็งฉๅบ"},
    "The Lovers": {"ko":"์ฐ์ธ - ์ฌ๋, ์ํ","en":"Love, choices","hi":"Love, choices","zh":"็ฑๆไธ้ๆฉ","ru":"Love, choices","ja":"ๆใจ้ธๆ"},
    "The Star": {"ko":"๋ณ - ํฌ๋ง, ์น์","en":"Hope, healing","hi":"Hope, healing","zh":"ๅธๆไธ็ๆ","ru":"Hope, healing","ja":"ๅธๆใป็ใ"},
    "The Sun": {"ko":"ํ์ - ํ๋ณต, ์ฑ๊ณต","en":"Joy, success","hi":"Joy, success","zh":"ๅฟซไนไธๆๅ","ru":"Joy, success","ja":"ๅนธ็ฆใปๆๅ"},
    "The World": {"ko":"์ธ๊ณ - ์์ฑ, ์ฑ์ทจ","en":"Completion, achievement","hi":"Completion, achievement","zh":"ๅฎๆไธๆๅฐฑ","ru":"Completion, achievement","ja":"ๅฎๆใป้ๆ"}
}


# =========================================
# 2) DB(JSON) ๋ก๋ / ์์ผ๋ฉด ์๋ ์์ฑ(๋์ฉ๋)
# =========================================
def _safe_read_json(fp: Path):
    try:
        with open(fp, "r", encoding="utf-8") as f:
            return json.load(f)
    except Exception:
        return None

@st.cache_data
def load_fortune_db(lang: str):
    fp = Path(__file__).parent / "data" / f"fortunes_{lang}.json"
    if fp.exists():
        db = _safe_read_json(fp)
        if isinstance(db, dict) and "daily" in db:
            return db, True  # True = external DB used
    # ์์ผ๋ฉด ์๋ ์์ฑ
    return generate_big_db(lang), False

def generate_big_db(lang: str):
    """
    ํ์ผ ์์ด๋ '๊ฒฐ๊ณผ ์๋ง ๊ฐ์ง' ๋์ค๊ฒ ํํ๋ฆฟ์ผ๋ก ๋๋ ์์ฑ.
    (10๋ฐฐ ํ์ฅ ์๊ตฌ ์ถฉ์กฑ: ์นดํ๊ณ๋ฆฌ 8๊ฐ ร ๋ฌธ์ฅ 20๊ฐ ์ด์ ์์ค)
    """
    # ๊ณตํต ์นดํ๊ณ๋ฆฌ
    categories = ["money","love","health","work","relationship","study","travel","mindset"]

    # ์ธ์ด๋ณ ๋ฌธ์ฅ ์กฐ๊ฐ(์งง๊ณ ์์ฐ์ค๋ฌ์ด ํค)
    # ์กฐ๊ฐ์ ์กฐํฉํด์ '๋งค๋ฒ ๋ค๋ฅธ ๋ฌธ์ฅ'์ ๋ง์ด ๋ง๋ค ์ ์์
    bank = {
        "ko": {
            "open": ["์ค๋์", "์ง๊ธ์", "์ด๋ฒ ํ๋ฆ์", "์ค๋์ ํฌ์ธํธ๋", "ํต์ฌ์"],
            "money_a": ["์ง์ถ ์๋ฆฌ", "๊ณ์๋น ์๊ฒ", "๋น๊ต ๊ตฌ๋งค", "ํ๋ถ/์์ฐ", "์์ ์์ฝ", "๊ธฐ๋ก ์ต๊ด", "์ถฉ๋ ์ต์", "๊ฐ์น ์๋น"],
            "money_b": ["๊ฐ ์๋ฆฌํด์.", "๋ถํฐ ํ๋ฉด ์ด๋์ด์์.", "๋ง ํด๋ ํ๋ฆ์ด ์ข์์ธ์.", "๊ฐ ๋์ด์ ์ด๋ค์ค์.", "๋ก ์ํด๋ฅผ ๋ง์ ์ ์์ด์."],
            "love_a": ["ํ ์ค ์ง์ฌ", "๊ฐ๋ฒผ์ด ์นญ์ฐฌ", "ํ์ด๋ฐ ์ข์ ์ฐ๋ฝ", "๊ณต๊ฐ ๋จผ์", "์๊ฐ ์ฝ์", "๋ถ๋๋ฌ์ด ํํ", "๋น๊ต ์ค์ด๊ธฐ", "์๋ ํ์"],
            "love_b": ["์ด ๊ด๊ณ์ด์ ์ฌ๋ค์ค์.", "์ด ๋ถ์๊ธฐ๋ฅผ ๋ฐ๊ฟ์.", "์ด ์คํด๋ฅผ ์ค์ฌ์ค์.", "์ด ์๋ขฐ๋ฅผ ํค์์ค์.", "์ด ๋งค๋ฅ์ผ๋ก ๋ณด์ฌ์."],
            "health_a": ["์๋ฉด", "์๋ถ", "๋ชฉ/์ด๊นจ ์คํธ๋์นญ", "๊ฐ๋ฒผ์ด ์ฐ์ฑ", "ํธํก", "์ฒด์จ ๊ด๋ฆฌ", "๋ ํด์", "์งง์ ๋ฃจํด"],
            "health_b": ["์ด ์ปจ๋์์ ์ข์ฐํด์.", "์ ์ฑ๊ธฐ๋ฉด ํ๋ฃจ๊ฐ ํธํด์.", "๋ง ํด๋ ํผ๋ก๊ฐ ์ค์ด์.", "์ด ๊ธฐ์ด์ ํ๋ณตํด์ค์.", "์ด ์ด์ ํ๋ฆ์ ๋ฐ๊ฟ์."],
            "work_a": ["๋ง๊ฐ ์๋ฆฌ", "๊ธฐ๋ก ๋จ๊ธฐ๊ธฐ", "์ฐ์์์ ์ฌ์๋ฌ", "ํ์ ์์ฒญ", "๊ฒ์ ์ฒดํฌ", "์งง์ ํ์", "์๋ํ ์์ด๋์ด", "์กฐ๊ฑด ํ์ธ"],
            "work_b": ["๊ฐ ์ฑ๊ณผ๋ก ์ด์ด์ธ์.", "๊ฐ ์ค์๋ฅผ ์ค์ฌ์ค์.", "๊ฐ ์ธ์๋ฐ๋ ํฌ์ธํธ์์.", "๊ฐ ์๊ฐ์ ์๊ปด์ค์.", "๊ฐ ์คํธ๋์ค๋ฅผ ๋ฎ์ถฐ์ค์."],
            "rel_a": ["์ง๋ฌธํ๊ธฐ", "์ธ์ฌ ๋จผ์", "์คํด ๋ฐ๋ก ํ๊ธฐ", "๊ฒฝ๊ณ ์ํ๊ธฐ", "์์ ๋ฐฐ๋ค", "์นญ์ฐฌ ํ ๋ง๋", "์์ฝ+๊ณต๊ฐ", "ํจ๊ป ํ๊ธฐ"],
            "rel_b": ["๊ฐ ๊ด๊ณ๋ฅผ ๋ถ๋๋ฝ๊ฒ ํด์.", "๊ฐ ์ฌ๋์ด์ ์ฌ๋ค์ค์.", "๊ฐ ๋์์ ๋ถ๋ฌ์์.", "๊ฐ ๊ฐ๋ฑ์ ์ค์ฌ์ค์.", "๊ฐ ์๋ขฐ๋ฅผ ๋ง๋ค์ด์."],
            "study_a": ["์์ 5๋ถ", "๊ฐ๋๋", "๋ณต์ต", "์ง๋ฌธ", "ํ ์ฅ ์์ฝ", "์ฅ์ ์ํ", "๋ฐฉํด ์์ ์๊ฑฐ", "์์ ๋ชฉํ"],
            "study_b": ["๋ง ์ง์ผ๋ ์ถฉ๋ถํด์.", "์ด ์์๋ฅผ ์ฌ๋ค์ค์.", "์ด ํจ์จ์ ํค์์ค์.", "์ด ๊ธฐ์ต์ ์ค๋๊ฐ๊ฒ ํด์.", "๊ฐ ์ง์ค์ ์ด๋ค์ค์."],
            "travel_a": ["10๋ถ ๋ฒํผ", "๊ฐ๊น์ด ์ธ์ถ", "์ ๋ฃจํธ", "์ฌ์ง ๊ธฐ๋ก", "์ฌ์ ์๋ ๊ณํ", "๋ณด์กฐ๋ฐฐํฐ๋ฆฌ", "์ฐ์ฐ", "๋์ฒด ํ๋"],
            "travel_b": ["๊ฐ ์คํธ๋์ค๋ฅผ ์ค์ฌ์ค์.", "๊ฐ ๋ง์กฑ๋๋ฅผ ํค์์ค์.", "๊ฐ ๋๋ฐ ์ํฉ์ ๋ง์์ค์.", "๊ฐ ์ข์ ์ถ์ต์ด ๋ผ์.", "๊ฐ ์ด์ ์ด๋ค์ค์."],
            "mind_a": ["์๋ฃ", "์๋ฆฌ", "์์ ์ฑ๊ณต", "๋น๊ต ์ค์ด๊ธฐ", "ํต์ ๊ฐ๋ฅํ ๊ฒ", "๋์ ๋ฐ๊ธฐ", "๋ฉ๋ชจ", "๊ฐ์ฌ 1์ค"],
            "mind_b": ["๋ฅผ ์ํํ๋ฉด ๋ง์์ด ํธํด์ธ์.", "๋ง ํด๋ ํ๋ฆ์ด ์ข์์ธ์.", "๊ฐ ์์๊ฐ์ ์ฌ๋ค์ค์.", "๊ฐ ๋ถ์์ ์ค์ฌ์ค์.", "๊ฐ ๋ด์ผ์ ๊ฐ๋ณ๊ฒ ํด์."]
        },
        "en": {
            "open": ["Today,", "Right now,", "This vibe says", "Key point:", "Focus on"],
            "money_a": ["tracking spending", "comparing prices", "cutting one fixed cost", "refund/settlement tasks", "small savings", "clear records", "avoiding impulse buys", "value-first choices"],
            "money_b": ["will help you most.", "brings a safer flow.", "prevents regrets.", "creates breathing room.", "protects your money luck."],
            "love_a": ["one sincere line", "a gentle compliment", "good message timing", "empathy first", "keeping small promises", "soft wording", "less comparison", "a warm smile"],
            "love_b": ["boosts connection.", "reduces misunderstandings.", "builds trust.", "changes the mood.", "makes you more attractive."],
            "health_a": ["sleep", "hydration", "neck/shoulder stretch", "a short walk", "deep breathing", "temperature balance", "eye breaks", "a 10-minute routine"],
            "health_b": ["decides your condition.", "makes the day easier.", "cuts fatigue.", "restores energy.", "shifts the flow."],
            "work_a": ["closing tasks", "documenting decisions", "reordering priorities", "asking for help", "using a checklist", "short meetings", "automation ideas", "checking conditions"],
            "work_b": ["turns into results.", "reduces mistakes.", "gets recognition.", "saves time.", "lowers stress."],
            "rel_a": ["asking questions", "greeting first", "clearing misunderstandings quickly", "setting boundaries", "small kindness", "one compliment", "summary + empathy", "doing it together"],
            "rel_b": ["smooths relationships.", "boosts people luck.", "invites support.", "reduces conflict.", "builds trust."],
            "study_a": ["the first 5 minutes", "concept mapping", "review", "asking questions", "one-page summary", "changing location", "removing distractions", "small goals"],
            "study_b": ["is enough today.", "raises efficiency.", "improves recall.", "brings momentum.", "boosts focus."],
            "travel_a": ["a 10-minute buffer", "a short outing", "a new route", "photo journaling", "flexible plans", "a power bank", "an umbrella", "a backup plan"],
            "travel_b": ["reduces stress.", "raises satisfaction.", "prevents trouble.", "creates good memories.", "improves your luck."],
            "mind_a": ["done over perfect", "tidying up", "small wins", "less comparison", "what you can control", "getting help", "writing it down", "one gratitude line"],
            "mind_b": ["makes you calmer.", "improves your flow.", "builds confidence.", "reduces anxiety.", "helps tomorrow-you."]
        },
        "hi": {
            "open": ["เคเค", "เคเคญเฅ", "เคเค เคเคพ เคธเคเคเฅเคค:", "เคฎเฅเคเฅเคฏ เคฌเคพเคค:", "เคซเฅเคเคธ เคเคฐเฅเค"],
            "money_a": ["เคเคฐเฅเค เคเคพ เคนเคฟเคธเคพเคฌ", "เคเฅเคฎเคค เคคเฅเคฒเคจเคพ", "เคเค เคธเฅเคฅเคพเคฏเฅ เคเคฐเฅเค เคเคฎ เคเคฐเคจเคพ", "เคฐเคฟเคซเคเคก/เคธเฅเคเคฒเคฎเฅเคเค", "เคเฅเคเฅ เคฌเคเคค", "เคธเฅเคชเคทเฅเค เคฐเคฟเคเฅเคฐเฅเคก", "เคเคฎเฅเคชเคฒเฅเคธ เคเคฐเฅเคฆ เคธเฅ เคฌเคเคจเคพ", "เคตเฅเคฒเฅเคฏเฅ-เคเคงเคพเคฐเคฟเคค เคเคฐเฅเคฆ"],
            "money_b": ["เคเคชเคเฅ เคฒเคฟเค เคฒเคพเคญเคฆเคพเคฏเค เคนเฅเคเคพเฅค", "เคซเฅเคฒเฅ เคเฅ เคธเฅเคฐเคเฅเคทเคฟเคค เคฐเคเฅเคเคพเฅค", "เคชเคเคคเคพเคตเคพ เคเคฎ เคเคฐเฅเคเคพเฅค", "เคเคงเคฟเค เคเคเคน เคฌเคจเคพเคเคเคพเฅค", "เคงเคจ เคญเคพเคเฅเคฏ เคฌเคขเคผเคพเคเคเคพเฅค"],
            "love_a": ["เคเค เคธเคเฅเคเฅ เคฒเคพเคเคจ", "เคนเคฒเฅเคเฅ เคคเคพเคฐเฅเคซ", "เคฎเฅเคธเฅเค เคเคพ เคธเคนเฅ เคธเคฎเคฏ", "เคชเคนเคฒเฅ เคธเคนเคพเคจเฅเคญเฅเคคเคฟ", "เคเฅเคเฅ เคตเคพเคฆเฅ เคจเคฟเคญเคพเคจเคพ", "เคจเคฐเคฎ เคถเคฌเฅเคฆ", "เคเคฎ เคคเฅเคฒเคจเคพ", "เคเคฐเคฎ เคฎเฅเคธเฅเคเคพเคจ"],
            "love_b": ["เคฐเคฟเคถเฅเคคเฅ เคเฅ เคฎเคเคฌเฅเคค เคเคฐเคคเฅ เคนเฅเฅค", "เคเคฒเคคเคซเคนเคฎเฅ เคเคเคพเคคเฅ เคนเฅเฅค", "เคตเคฟเคถเฅเคตเคพเคธ เคฌเคขเคผเคพเคคเฅ เคนเฅเฅค", "เคฎเคพเคนเฅเคฒ เคฌเคฆเคฒเคคเฅ เคนเฅเฅค", "เคเคชเคเฅ เคเคเคฐเฅเคทเค เคฌเคจเคพเคคเฅ เคนเฅเฅค"],
            "health_a": ["เคจเฅเคเคฆ", "เคชเคพเคจเฅ", "เคเคฐเฅเคฆเคจ/เคเคเคงเฅ เคธเฅเคเฅเคฐเฅเค", "เคเฅเคเฅ เคธเฅเคฐ", "เคเคนเคฐเฅ เคธเคพเคเคธ", "เคคเคพเคชเคฎเคพเคจ เคธเคเคคเฅเคฒเคจ", "เคเคเคเฅเค เคเคพ เคฌเฅเคฐเฅเค", "10 เคฎเคฟเคจเค เคฐเฅเคเฅเคจ"],
            "health_b": ["เคเคเคกเฅเคถเคจ เคคเคฏ เคเคฐเคคเฅ เคนเฅเฅค", "เคฆเคฟเคจ เคเคธเคพเคจ เคฌเคจเคพเคคเฅ เคนเฅเฅค", "เคฅเคเคพเคจ เคเคเคพเคคเฅ เคนเฅเฅค", "เคเคฐเฅเคเคพ เคฒเฅเคเคพเคคเฅ เคนเฅเฅค", "เคซเฅเคฒเฅ เคฌเคฆเคฒ เคฆเฅเคคเฅ เคนเฅเฅค"],
            "work_a": ["เคเคพเคฎ เคชเฅเคฐเคพ เคเคฐเคจเคพ", "เคจเคฟเคฐเฅเคฃเคฏ เคฒเคฟเคเคจเคพ", "เคชเฅเคฐเคพเคฅเคฎเคฟเคเคคเคพ เคฌเคฆเคฒเคจเคพ", "เคฎเคฆเคฆ เคฎเคพเคเคเคจเคพ", "เคเฅเคเคฒเคฟเคธเฅเค", "เคเฅเคเฅ เคฎเฅเคเคฟเคเค", "เคเคเฅเคฎเฅเคถเคจ เคเคเคกเคฟเคฏเคพ", "เคถเคฐเฅเคคเฅเค เคเคพเคเคเคจเคพ"],
            "work_b": ["เคเคเฅเคเฅ เคชเคฐเคฟเคฃเคพเคฎ เคฆเฅเคคเคพ เคนเฅเฅค", "เคเคฒเคคเคฟเคฏเคพเค เคเคฎ เคเคฐเคคเคพ เคนเฅเฅค", "เคธเคฐเคพเคนเคจเคพ เคฆเคฟเคฒเคพเคคเคพ เคนเฅเฅค", "เคธเคฎเคฏ เคฌเคเคพเคคเคพ เคนเฅเฅค", "เคคเคจเคพเคต เคเคเคพเคคเคพ เคนเฅเฅค"],
            "rel_a": ["เคธเคตเคพเคฒ เคชเฅเคเคจเคพ", "เคชเคนเคฒเฅ เคจเคฎเคธเฅเคคเฅ", "เคเคฒเคคเคซเคนเคฎเฅ เคเคฒเฅเคฆเฅ เคธเคพเคซ", "เคธเฅเคฎเคพเคเค เคคเคฏ เคเคฐเคจเคพ", "เคเฅเคเฅ เคฎเคฆเคฆ", "เคเค เคคเคพเคฐเฅเคซ", "เคธเคพเคฐ + เคธเคนเคพเคจเฅเคญเฅเคคเคฟ", "เคธเคพเคฅ เคฎเคฟเคฒเคเคฐ เคเคฐเคจเคพ"],
            "rel_b": ["เคฐเคฟเคถเฅเคคเฅ เคฌเฅเคนเคคเคฐ เคเคฐเคคเคพ เคนเฅเฅค", "เคฒเฅเคเฅเค เคเคพ เคธเคฎเคฐเฅเคฅเคจ เคฌเคขเคผเคพเคคเคพ เคนเฅเฅค", "เคฎเคฆเคฆ เคฌเฅเคฒเคพเคคเคพ เคนเฅเฅค", "เคเคเคฐเคพเคต เคเคเคพเคคเคพ เคนเฅเฅค", "เคตเคฟเคถเฅเคตเคพเคธ เคฌเคจเคพเคคเคพ เคนเฅเฅค"],
            "study_a": ["เคชเคนเคฒเฅ 5 เคฎเคฟเคจเค", "เคเฅเคจเคธเฅเคชเฅเค เคฎเฅเคช", "เคฐเคฟเคตเคฟเคเคผเคจ", "เคชเฅเคฐเคถเฅเคจ เคชเฅเคเคจเคพ", "เคเค เคชเฅเค เคธเคพเคฐ", "เคเคเคน เคฌเคฆเคฒเคจเคพ", "เคกเคฟเคธเฅเคเฅเคฐเฅเคเฅเคถเคจ เคนเคเคพเคจเคพ", "เคเฅเคเฅ เคฒเคเฅเคทเฅเคฏ"],
            "study_b": ["เคเค เคชเคฐเฅเคฏเคพเคชเฅเคค เคนเฅเฅค", "เคฆเคเฅเคทเคคเคพ เคฌเคขเคผเคพเคคเคพ เคนเฅเฅค", "เคฏเคพเคฆเคฆเคพเคถเฅเคค เคฎเคเคฌเฅเคค เคเคฐเคคเคพ เคนเฅเฅค", "เคเคคเคฟ เคฌเคจเคพเคคเคพ เคนเฅเฅค", "เคซเฅเคเคธ เคฌเคขเคผเคพเคคเคพ เคนเฅเฅค"],
            "travel_a": ["10 เคฎเคฟเคจเค เคฌเคซเคฐ", "เคเฅเคเฅ เคเคเคเคฟเคเค", "เคจเคฏเคพ เคฐเคพเคธเฅเคคเคพ", "เคซเฅเคเฅ เคจเฅเค", "เคฒเคเฅเคฒเฅ เคฏเฅเคเคจเคพ", "เคชเคพเคตเคฐ เคฌเฅเคเค", "เคเคพเคคเคพ", "เคฌเฅเคเคเคช เคชเฅเคฒเคพเคจ"],
            "travel_b": ["เคคเคจเคพเคต เคเคเคพเคคเคพ เคนเฅเฅค", "เคธเคเคคเฅเคท เคฌเคขเคผเคพเคคเคพ เคนเฅเฅค", "เคฎเฅเคธเฅเคฌเคค เคฐเฅเคเคคเคพ เคนเฅเฅค", "เคเคเฅเคเฅ เคฏเคพเคฆเฅเค เคฌเคจเคพเคคเคพ เคนเฅเฅค", "เคญเคพเคเฅเคฏ เคฌเคขเคผเคพเคคเคพ เคนเฅเฅค"],
            "mind_a": ["เคชเคฐเคซเฅเคเฅเค เคจเคนเฅเค, เคชเฅเคฐเคพ", "เคธเคซเคพเค", "เคเฅเคเฅ เคเฅเคค", "เคเคฎ เคคเฅเคฒเคจเคพ", "เคเฅ เคจเคฟเคฏเคเคคเฅเคฐเคฟเคค เคนเฅ", "เคฎเคฆเคฆ เคฒเฅเคจเคพ", "เคฒเคฟเคเคจเคพ", "เคเค เคฒเคพเคเคจ เคงเคจเฅเคฏเคตเคพเคฆ"],
            "mind_b": ["เคฎเคจ เคนเคฒเฅเคเคพ เคเคฐเคคเคพ เคนเฅเฅค", "เคซเฅเคฒเฅ เคฌเฅเคนเคคเคฐ เคเคฐเคคเคพ เคนเฅเฅค", "เคเคคเฅเคฎเคตเคฟเคถเฅเคตเคพเคธ เคฌเคขเคผเคพเคคเคพ เคนเฅเฅค", "เคเคฟเคเคคเคพ เคเคเคพเคคเคพ เคนเฅเฅค", "เคเคฒ เคเฅ เคเคธเคพเคจ เคฌเคจเคพเคคเคพ เคนเฅเฅค"]
        },
        "zh": {
            "open": ["ไปๅคฉ", "็ฐๅจ", "ๅณ้ฎๆฏ", "้็นๆฏ", "ๅปบ่ฎฎไฝ"],
            "money_a": ["ๆด็ๆฏๅบ", "่ๅฟๆฏไปท", "้ไฝไธ้กนๅบๅฎๆๆฌ", "ๅค็้ๆฌพ/็ป็ฎ", "ๅๅฐ้ข่็", "็ไธ่ฎฐๅฝ", "้ฟๅๅฒๅจไนฐ", "้่งไปทๅผ่้ไฝไปท"],
            "money_b": ["ไผๆดๅ็ฎใ", "่ฝ่ฎฉ่ดข่ฟๆด็จณใ", "่ฝๅๅฐๅๆใ", "ไผๅธฆๆฅ็ฉบ้ดๆใ", "่ฝไฟๆคไฝ็็ฐ้ๆตใ"],
            "love_a": ["ไธๅฅ็่ฏ่กจ่พพ", "่ฝป่ฝปๅคธๅฅ", "ๆๆกๆถๆฏๆถๆบ", "ๅๅฑๆ", "ๅฎไฝๅฐๆฟ่ฏบ", "่ฏญๆฐๆๅ", "ๅๅฐๆฏ่พ", "ๅๅพฎ็ฌ"],
            "love_b": ["่ฝๅๆธฉๅณ็ณปใ", "่ฝๅๅฐ่ฏฏไผใ", "่ฝๅปบ็ซไฟกไปปใ", "ไผๆนๅๆฐๅดใ", "ไผ่ฎฉไฝๆดๆ้ญๅใ"],
            "health_a": ["ๆฉ็น็ก", "ๅคๅๆฐด", "้ข่ฉๆไผธ", "็ญๆญฅ่ก", "ๆทฑๅผๅธ", "ๆณจๆๆธฉๅทฎ", "็ผ็ไผๆฏ", "10ๅ้ๅฐ่ฟๅจ"],
            "health_b": ["ๅณๅฎไฝ็็ถๆใ", "่ฎฉไธๅคฉๆด่ฝปๆพใ", "ๆๆพๅ่ฝป็ฒๅณใ", "ๆขๅค่ฝ้ใ", "ๆนๅๆดไฝ่ๅฅใ"],
            "work_a": ["ๆถๅฐพไธๆด็", "่ฎฐๅฝๅณๅฎ", "่ฐๆดไผๅ็บง", "ไธปๅจๅไฝ", "็จๆฃๆฅๆธๅ", "็ญไผๅฟซๅณ", "ๅฐ่ฏ่ชๅจๅ", "ๅ็ๆกไปถๅ็ญๅบ"],
            "work_b": ["ๆดๅฎนๆๅบๆๆใ", "่ฝๅๅฐ้่ฏฏใ", "ๆดๅฎนๆ่ขซ่ฎคๅฏใ", "่ฝ็ๆถ้ดใ", "่ฝ้ไฝๅๅใ"],
            "rel_a": ["ๅคๆ้ฎ", "ๅๆๆๅผ", "ๅๆถๆพๆธ่ฏฏไผ", "่ฎพ็ฝฎ่พน็", "ๅฐๅฐๅๆ", "ไธๅฅๅคธๅฅ", "ๆป็ป+ๅฑๆ", "ไธ่ตทๅฎๆ"],
            "rel_b": ["ไผ่ฎฉๅณ็ณปๆด้กบใ", "ไผๆๅไบบ็ผ่ฟใ", "ไผๅผๆฅๅธฎๅฉใ", "ไผๅๅฐๅฒ็ชใ", "ไผๅปบ็ซไฟกไปปใ"],
            "study_a": ["ๅๅผๅง5ๅ้", "็ปๆฆๅฟตๅพ", "ๅคไน", "ๅๆขๆ้ฎ", "ไธ้กตๆป็ป", "ๆขไธชๅฐๆน", "ๅๅฐๅนฒๆฐ", "่ฎพๅฐ็ฎๆ"],
            "study_b": ["ไปๅคฉๅฐฑๅคไบใ", "ๆ็ไผๆด้ซใ", "่ฎฐๅพๆด็ขใ", "ๆดๅฎนๆ่ฟๅฅ็ถๆใ", "ไธๆณจๅๆดๅผบใ"],
            "travel_a": ["็10ๅ้ไฝ้", "็ญ้ๅบ้จ", "ๅฐ่ฏๆฐ่ทฏ็บฟ", "ๆ็ง่ฎฐๅฝ", "่ฎกๅ็็ฉบ", "ๅธฆๅ็ตๅฎ", "ๅธฆไผ", "ๅๅคๅค้ๆนๆก"],
            "travel_b": ["่ฝๅๅฐ็ฆ่ใ", "ไผๆๅๆปกๆๅบฆใ", "่ฝ้ฟๅๅฐ้บป็ฆใ", "ไผๅๆๅฅฝๅๅฟใ", "่ฝๆๅๅฅฝ่ฟใ"],
            "mind_a": ["ๅๅฎๆๅๅฎ็พ", "ๆด็ไธไธ", "ๆฟ่ฎคๅฐ่ฟๆญฅ", "ๅฐๆฏ่พ", "ๅณๆณจๅฏๆง็ไบ", "ๆฅๅๅธฎๅฉ", "ๅไธๆฅ", "็กๅไธ่กๆๆฉ"],
            "mind_b": ["ไผๆดๅฎๅฟใ", "ไผ่ฎฉ่ๅฅๆด้กบใ", "ไผๆๅ่ชไฟกใ", "่ฝๅๅฐ็ฆ่ใ", "่ฎฉๆๅคฉๆด่ฝปๆพใ"]
        },
        "ru": {
            "open": ["ะกะตะณะพะดะฝั", "ะกะตะนัะฐั", "ะะปัั:", "ะคะพะบัั:", "ะะปะฐะฒะฝะพะต โ"],
            "money_a": ["ัะฟะพััะดะพัะธัั ัะฐััะพะดั", "ััะฐะฒะฝะธัั ัะตะฝั", "ัะฝะธะทะธัั ะพะดะธะฝ ัะธะบัะธัะพะฒะฐะฝะฝัะน ะฟะปะฐััะถ", "ะทะฐะบัััั ะฒะพะทะฒัะฐัั/ัะฐััััั", "ัะดะตะปะฐัั ะผะฐะปะตะฝัะบัั ัะบะพะฝะพะผะธั", "ะพััะฐะฒะปััั ะทะฐะฟะธัะธ", "ะธะทะฑะตะณะฐัั ะธะผะฟัะปััะธะฒะฝัั ะฟะพะบัะฟะพะบ", "ะฒัะฑะธัะฐัั ัะตะฝะฝะพััั, ะฐ ะฝะต ะดะตัะตะฒะธะทะฝั"],
            "money_b": ["ะดะฐัั ะฑะพะปััะต ะฒัะณะพะดั.", "ัะดะตะปะฐะตั ะฟะพัะพะบ ััะฐะฑะธะปัะฝะตะต.", "ัะผะตะฝััะธั ัะพะถะฐะปะตะฝะธั.", "ะดะฐัั ะฑะพะปััะต ัะฒะพะฑะพะดั.", "ะทะฐัะธัะธั ัะธะฝะฐะฝัะพะฒัั ัะดะฐัั."],
            "love_a": ["ะพะดะฝะฐ ะธัะบัะตะฝะฝัั ััะฐะทะฐ", "ะปัะณะบะธะน ะบะพะผะฟะปะธะผะตะฝั", "ัะดะฐัะฝัะน ะผะพะผะตะฝั ะฝะฐะฟะธัะฐัั", "ัะผะฟะฐัะธั ะฟัะตะถะดะต ะฒัะตะณะพ", "ะผะฐะปะตะฝัะบะธะต ะพะฑะตัะฐะฝะธั", "ะผัะณะบะธะน ัะพะฝ", "ะผะตะฝััะต ััะฐะฒะฝะตะฝะธะน", "ััะฟะปะฐั ัะปัะฑะบะฐ"],
            "love_b": ["ััะธะปะธั ะฑะปะธะทะพััั.", "ัะฝะธะทะธั ะฝะตะดะพะฟะพะฝะธะผะฐะฝะธะต.", "ะฟะพัััะพะธั ะดะพะฒะตัะธะต.", "ะธะทะผะตะฝะธั ะฐัะผะพััะตัั.", "ัะดะตะปะฐะตั ะฒะฐั ะฟัะธะฒะปะตะบะฐัะตะปัะฝะตะต."],
            "health_a": ["ัะพะฝ", "ะฒะพะดะฐ", "ัะฐัััะถะบะฐ ัะตะธ/ะฟะปะตั", "ะบะพัะพัะบะฐั ะฟัะพะณัะปะบะฐ", "ะณะปัะฑะพะบะพะต ะดััะฐะฝะธะต", "ะฑะฐะปะฐะฝั ัะตะผะฟะตัะฐัััั", "ะพัะดัั ะดะปั ะณะปะฐะท", "10-ะผะธะฝััะฝะฐั ัััะธะฝะฐ"],
            "health_b": ["ัะตัะฐะตั ัะฐะผะพััะฒััะฒะธะต.", "ะดะตะปะฐะตั ะดะตะฝั ะปะตะณัะต.", "ัะฝะธะผะฐะตั ัััะฐะปะพััั.", "ะฒะพะทะฒัะฐัะฐะตั ัะฝะตัะณะธั.", "ะผะตะฝัะตั ะพะฑัะธะน ัะธัะผ."],
            "work_a": ["ะทะฐะบััะฒะฐัั ะทะฐะดะฐัะธ", "ัะธะบัะธัะพะฒะฐัั ัะตัะตะฝะธั", "ะฟะตัะตัััะพะธัั ะฟัะธะพัะธัะตัั", "ะฟัะพัะธัั ะฟะพะผะพัั", "ัะตะบ-ะปะธัั", "ะบะพัะพัะบะธะต ะฒัััะตัะธ", "ะธะดะตะธ ะฐะฒัะพะผะฐัะธะทะฐัะธะธ", "ะฟัะพะฒะตัะธัั ััะปะพะฒะธั ะฟะตัะตะด ัะพะณะปะฐัะธะตะผ"],
            "work_b": ["ะฟัะธะฒะพะดะธั ะบ ัะตะทัะปััะฐัั.", "ัะผะตะฝััะฐะตั ะพัะธะฑะบะธ.", "ะดะฐัั ะฟัะธะทะฝะฐะฝะธะต.", "ัะบะพะฝะพะผะธั ะฒัะตะผั.", "ัะฝะธะถะฐะตั ัััะตัั."],
            "rel_a": ["ะทะฐะดะฐะฒะฐัั ะฒะพะฟัะพัั", "ะฟะพะทะดะพัะพะฒะฐัััั ะฟะตัะฒัะผ", "ััะฐะทั ะฟัะพััะฝััั", "ััะฐะฒะธัั ะณัะฐะฝะธัั", "ะผะฐะปะตะฝัะบะฐั ะดะพะฑัะพัะฐ", "ะพะดะธะฝ ะบะพะผะฟะปะธะผะตะฝั", "ะบัะฐัะบะพ + ั ัะผะฟะฐัะธะตะน", "ะดะตะปะฐัั ะฒะผะตััะต"],
            "rel_b": ["ะดะตะปะฐะตั ะพัะฝะพัะตะฝะธั ะผัะณัะต.", "ะฟะพะฒััะฐะตั ัะดะฐัั ะฒ ะปัะดัั.", "ะฟัะธะฒะปะตะบะฐะตั ะฟะพะดะดะตัะถะบั.", "ัะผะตะฝััะฐะตั ะบะพะฝัะปะธะบัั.", "ัััะพะธั ะดะพะฒะตัะธะต."],
            "study_a": ["ะฟะตัะฒัะต 5 ะผะธะฝัั", "ะบะฐััะฐ ะฟะพะฝััะธะน", "ะฟะพะฒัะพัะตะฝะธะต", "ะทะฐะดะฐะฒะฐัั ะฒะพะฟัะพัั", "ะพะดะฝะฐ ัััะฐะฝะธัะฐ ะธัะพะณะพะฒ", "ัะผะตะฝะธัั ะผะตััะพ", "ัะฑัะฐัั ะพัะฒะปะตัะตะฝะธั", "ะผะฐะปะตะฝัะบะฐั ัะตะปั"],
            "study_b": ["ะฝะฐ ัะตะณะพะดะฝั ะดะพััะฐัะพัะฝะพ.", "ะฟะพะฒััะฐะตั ัััะตะบัะธะฒะฝะพััั.", "ัะปัััะฐะตั ะฟะฐะผััั.", "ะดะฐัั ัะตะผะฟ.", "ััะธะปะธะฒะฐะตั ะบะพะฝัะตะฝััะฐัะธั."],
            "travel_a": ["10 ะผะธะฝัั ะทะฐะฟะฐัะฐ", "ะบะพัะพัะบะฐั ะฒัะปะฐะทะบะฐ", "ะฝะพะฒัะน ะผะฐััััั", "ัะพัะพ-ะทะฐะผะตัะบะธ", "ะณะธะฑะบะธะน ะฟะปะฐะฝ", "ะฟะฐัััะฑะฐะฝะบ", "ะทะพะฝั", "ะทะฐะฟะฐัะฝะพะน ะฟะปะฐะฝ"],
            "travel_b": ["ัะฝะธะถะฐะตั ััะตะฒะพะณั.", "ะฟะพะฒััะฐะตั ัะดะพะฒะพะปัััะฒะธะต.", "ะฟัะตะดะพัะฒัะฐัะฐะตั ะผะตะปะบะธะต ะฟัะพะฑะปะตะผั.", "ััะฐะฝะพะฒะธััั ัะพัะพัะตะน ะฟะฐะผัััั.", "ัะปัััะฐะตั ัะดะฐัั."],
            "mind_a": ["ัะดะตะปะฐะฝะพ ะฒะฐะถะฝะตะต ะธะดะตะฐะปะฐ", "ะฝะตะผะฝะพะณะพ ะฟะพััะดะบะฐ", "ะผะฐะปะตะฝัะบะธะต ะฟะพะฑะตะดั", "ะผะตะฝััะต ััะฐะฒะฝะตะฝะธะน", "ัะพ, ััะพ ะฟะพะด ะบะพะฝััะพะปะตะผ", "ะฟัะธะฝะธะผะฐัั ะฟะพะผะพัั", "ะทะฐะฟะธัะฐัั", "ะพะดะฝะฐ ัััะพะบะฐ ะฑะปะฐะณะพะดะฐัะฝะพััะธ"],
            "mind_b": ["ะดะตะปะฐะตั ัะฟะพะบะพะนะฝะตะต.", "ัะปัััะฐะตั ะฟะพัะพะบ.", "ะดะฐัั ัะฒะตัะตะฝะฝะพััั.", "ัะฝะธะถะฐะตั ััะตะฒะพะถะฝะพััั.", "ะพะฑะปะตะณัะฐะตั ะทะฐะฒััะฐ."]
        },
        "ja": {
            "open": ["ไปๆฅใฏ", "ไปใฏ", "ใใคใณใใฏ", "ใณใใฏ", "ๅคงไบใชใฎใฏ"],
            "money_a": ["ๆฏๅบใฎๆด็", "ไพกๆผๆฏ่ผ", "ๅบๅฎ่ฒปใไธใคๆธใใ", "่ฟ้/็ฒพ็ฎใฎๅฆ็", "ๅฐใใช็ฏ็ด", "่จ้ฒใๆฎใ", "่กๅ่ฒทใใ้ฟใใ", "ๅฎใใใไพกๅค้่ฆ"],
            "money_b": ["ใๅพใงใใ", "ใงๆตใใๅฎๅฎใใพใใ", "ใงๅพๆใๆธใใพใใ", "ใงไฝ่ฃใ็ใพใใพใใ", "ใง้้ใๅฎใใพใใ"],
            "love_a": ["ไธ่จใฎๆฌ้ณ", "่ปฝใ่คใ่จ่", "้ฃ็ตกใฎใฟใคใใณใฐ", "ๅฑๆใๅใซ", "ๅฐใใช็ดๆ", "ใใใใใ่จใๆน", "ๆฏ่ผใๆธใใ", "็ฌ้ก"],
            "love_b": ["ใ่ท้ขใ็ธฎใใพใใ", "ใ่ชค่งฃใๆธใใใพใใ", "ใไฟก้ผใไฝใใพใใ", "ใ็ฉบๆฐใๅคใใพใใ", "ใ้ญๅใซใชใใพใใ"],
            "health_a": ["็ก็", "ๆฐดๅ", "้ฆ่ฉในใใฌใใ", "็ญใๆฃๆญฉ", "ๆทฑๅผๅธ", "ๆธฉๅบฆๅทฎๅฏพ็ญ", "็ฎใฎไผๆฉ", "10ๅใซใผใใฃใณ"],
            "health_b": ["ใไฝ่ชฟใๅทฆๅณใใพใใ", "ใงไธๆฅใๆฅฝใซใชใใพใใ", "ใง็ฒใใๆธใใพใใ", "ใงๅๆฐใๆปใใพใใ", "ใงๆตใใๅคใใใพใใ"],
            "work_a": ["็ทใไฝๆฅญ", "ๆฑบๅฎใฎ่จ้ฒ", "ๅชๅ้ไฝใฎ่ฆ็ดใ", "ๅๅใ้ผใ", "ใใงใใฏใชในใ", "็ญใไผ่ญฐ", "่ชๅๅใขใคใใข", "ๆกไปถ็ขบ่ช"],
            "work_b": ["ใๆๆใซใคใชใใใพใใ", "ใใในใๆธใใใพใใ", "ใ่ฉไพกใใใพใใ", "ใๆ้ใ็ฏ็ดใใพใใ", "ใในใใฌในใไธใใพใใ"],
            "rel_a": ["่ณชๅใๅขใใ", "ๅใซๆจๆถ", "่ชค่งฃใใใ่งฃใ", "ๅข็็ทใๆฑบใใ", "ๅฐใใช่ฆชๅ", "ไธ่จใฎ็งฐ่ณ", "่ฆ็ด+ๅฑๆ", "ไธ็ทใซใใ"],
            "rel_b": ["ใง้ขไฟใใใใใใพใใ", "ใงไบบ้ใไธใใใพใใ", "ใงๅฉใใๆฅใพใใ", "ใง่ก็ชใๆธใใพใใ", "ใงไฟก้ผใๅขใใพใใ"],
            "study_a": ["ๆๅใฎ5ๅ", "ๆฆๅฟตๅณ", "ๅพฉ็ฟ", "่ณชๅ", "1ๆใพใจใ", "ๅดๆใๅคใใ", "้ช้ญใๆธใใ", "ๅฐใใช็ฎๆจ"],
            "study_b": ["ใใใงๅๅใงใใ", "ใงๅน็ใไธใใใพใใ", "ใง่จๆถใๆฎใใพใใ", "ใงๅขใใๅบใพใใ", "ใง้ไธญใงใใพใใ"],
            "travel_a": ["10ๅใใใใก", "่ฟๅดใฎใๅบใใ", "ๆฐใซใผใ", "ๅ็ใกใข", "ไฝ็ฝใฎ่จ็ป", "ใขใใคใซใใใใชใผ", "ๅ", "ไปฃๆฟๆก"],
            "travel_b": ["ใงไธๅฎใๆธใใพใใ", "ใงๆบ่ถณๅบฆใไธใใใพใใ", "ใงๅฐใใฉใใซใ้ฒใใพใใ", "ใง่ฏใๆใๅบใซใชใใพใใ", "ใง้ใๆดใใพใใ"],
            "mind_a": ["ๅฎ็งใใๅฎไบ", "ๆด็", "ๅฐใใชๆๅ", "ๆฏ่ผใๆธใใ", "่ชๅใๅถๅพกใงใใใใจ", "ๅฉใใใใใ", "ๆธใๅบใ", "ๆ่ฌใไธ่ก"],
            "mind_b": ["ใงๅฟใ่ปฝใใชใใพใใ", "ใงๆตใใ่ฏใใชใใพใใ", "ใง่ชไฟกใๅขใใพใใ", "ใงไธๅฎใๆธใใพใใ", "ใงๆๆฅใๆฅฝใซใชใใพใใ"]
        }
    }

    # fallback: ์์ผ๋ฉด ์์ด bank ์ฌ์ฉ
    if lang not in bank:
        lang = "en"

    b = bank[lang]
    rng = random.Random(20260101 + len(lang))  # ๊ณ์ ์์ฑ(ํ์ผ ๋ค์ด๋ก๋์ ๋งค๋ฒ ๊ฐ์ DB)

    def build_list(kind_a, kind_b, count=24):
        out = []
        for _ in range(count):
            s = f"{rng.choice(b['open'])} {rng.choice(b[kind_a])}{rng.choice(b[kind_b])}"
            out.append(s)
        # ์ค๋ณต ์ค์ด๊ธฐ
        out = list(dict.fromkeys(out))
        while len(out) < count:
            out.append(f"{rng.choice(b['open'])} {rng.choice(b[kind_a])}{rng.choice(b[kind_b])}")
            out = list(dict.fromkeys(out))
        return out[:count]

    daily = {
        "money": build_list("money_a", "money_b"),
        "love": build_list("love_a", "love_b"),
        "health": build_list("health_a", "health_b"),
        "work": build_list("work_a", "work_b"),
        "relationship": build_list("rel_a", "rel_b"),
        "study": build_list("study_a", "study_b"),
        "travel": build_list("travel_a", "travel_b"),
        "mindset": build_list("mind_a", "mind_b")
    }

    yearly = {
        "general": daily["mindset"][:12],
        "career": daily["work"][:12],
        "money": daily["money"][:12],
        "love": daily["love"][:12]
    }

    combo = {
        "zodiac_mbti": [
            "{zodiac} + {mbti_desc} ์กฐํฉ์ โ์๋ฆฌโ์คํโ์ด ๊ฐํด์." if lang == "ko" else
            "{zodiac} + {mbti_desc} combo: organize โ execute." if lang == "en" else
            "{zodiac} + {mbti_desc} combo: organize โ execute."
        ] * 25
    }

    lucky = {
        "colors": ["Gold","Red","Blue","Green","Purple","Silver","Navy","Mint","Pink","Off-white"],
        "items": [
            "Small notebook","Card wallet","Mini perfume","Power bank","Keychain",
            "Tumbler","Wristwatch","Wireless earbuds","Umbrella","Lip balm"
        ],
        "tips": daily["mindset"][:20]
    }

    return {"daily": daily, "yearly": yearly, "combo": combo, "lucky": lucky}


# =========================================
# 3) ์ํธ
# =========================================
def get_zodiac(year: int, lang: str):
    if not (1900 <= year <= 2030):
        return None
    idx = (year - 4) % 12
    return ZODIAC_LIST.get(lang, ZODIAC_LIST["en"])[idx]

def get_saju(y: int, m: int, d: int, lang: str):
    arr = SAJU_MSGS.get(lang, SAJU_MSGS["en"])
    return arr[(y + m + d) % len(arr)]

def stable_rng(name: str, y: int, m: int, d: int, mbti: str, lang: str):
    key = f"{lang}|{name}|{y:04d}-{m:02d}-{d:02d}|{mbti}"
    seed = abs(hash(key)) % (10**9)
    return random.Random(seed)


# =========================================
# 4) Streamlit ๊ธฐ๋ณธ/UI
# =========================================
st.set_page_config(page_title="2026 Fortune", layout="centered")

if "lang" not in st.session_state:
    st.session_state.lang = "ko"
if "result" not in st.session_state:
    st.session_state.result = False
if "name" not in st.session_state:
    st.session_state.name = ""
if "birthdate" not in st.session_state:
    st.session_state.birthdate = date(2005, 1, 1)
if "mbti" not in st.session_state:
    st.session_state.mbti = "ENFJ"

# ๋ชจ๋ฐ์ผ ์ต์ํ CSS (์๋จ ์๋ฆผ/์ฌ๋ฐฑ)
st.markdown(
    """
    <style>
      header {visibility: hidden;}
      #MainMenu {visibility: hidden;}
      footer {visibility: hidden;}
      .stApp { background: #efe9ff; }
      .block-container {
        padding-top: 10px !important;
        padding-bottom: 30px !important;
        max-width: 760px;
      }
      .title { font-size: 28px; font-weight: 900; color:#2b2b2b; text-align:center; margin: 14px 0 4px;}
      .subtitle { font-size: 14px; font-weight: 700; color:#555; text-align:center; margin: 0 0 14px;}
      .card {
        background: rgba(255,255,255,0.78);
        border: 1px solid rgba(140,120,200,0.25);
        border-radius: 18px;
        padding: 16px;
        box-shadow: 0 10px 22px rgba(0,0,0,0.08);
        margin: 10px 0 16px;
      }
      .card p { margin: 6px 0; line-height: 1.65; font-size: 14.5px; color:#2b2b2b; }
      .kv { font-weight: 900; }
      .bigline { font-size: 20px; font-weight: 900; text-align: center; color: #2b2b2b; margin: 8px 0 4px;}
      @media (max-width: 480px) {.title { font-size: 24px; } .bigline { font-size: 18px; }}
    </style>
    """,
    unsafe_allow_html=True
)

# ์ธ์ด ์ํ
st.session_state.lang = st.radio(
    UI.get(st.session_state.lang, UI["en"])["lang_label"],
    list(LANG_OPTIONS.keys()),
    format_func=lambda k: LANG_OPTIONS[k],
    horizontal=True
)
lang = st.session_state.lang
t = UI.get(lang, UI["en"])


# ์ฑ URL(๋ฐฐํฌ ํ ๋ฐ๊พธ๊ธฐ)
APP_URL = "https://my-fortune.streamlit.app"


# =========================================
# 5) ์๋ฅ ํ๋ฉด
# =========================================
if not st.session_state.result:
    st.markdown(f"<div class='title'>{t['title']}</div>", unsafe_allow_html=True)
    st.markdown(f"<div class='subtitle'>{t['subtitle']}</div>", unsafe_allow_html=True)

    st.session_state.name = st.text_input(t["name_label"], value=st.session_state.name)

    st.session_state.birthdate = st.date_input(
        t["birth_label"],
        value=st.session_state.birthdate,
        min_value=date(1900, 1, 1),
        max_value=date(2030, 12, 31),
    )

    mbti_mode = st.radio(t["mbti_mode"], [t["mbti_direct"], t["mbti_test"]], horizontal=True)

    if mbti_mode == t["mbti_direct"]:
        st.session_state.mbti = st.selectbox("MBTI", sorted(MBTIS.get(lang, MBTIS["en"]).keys()))
        if st.button(t["btn_view"], use_container_width=True):
            st.session_state.result = True
            st.rerun()

    else:
        st.caption(t["test_caption"])

        # 12๋ฌธํญ(๊ฐ ์ถ 3๋ฌธํญ) - ๊ฐ๋จ/์ธ์ด์ ๋ฌด๊ดํ๊ฒ ์์ด ๋ฌธํญ ์ฌ์ฉ (์ด๋ณด์ฉ ์์)
        q_ei = [
            ("If plans come up suddenly?", "Awesome! Let's go (E)", "I'd rather stay home (I)"),
            ("You recharge byโฆ", "Meeting people (E)", "Being alone (I)"),
            ("When talking, youโฆ", "Think while speaking (E)", "Think first, then speak (I)")
        ]
        q_sn = [
            ("When seeing new info?", "Facts & details (S)", "Possibilities & meaning (N)"),
            ("You prefer explanations withโฆ", "Examples & specifics (S)", "Big picture (N)"),
            ("Your ideas are usuallyโฆ", "Proven methods (S)", "New approaches (N)")
        ]
        q_tf = [
            ("In conflict, you chooseโฆ", "Logic & principles (T)", "Care & harmony (F)"),
            ("Your decision base isโฆ", "Efficiency & accuracy (T)", "Values & feelings (F)"),
            ("When giving feedbackโฆ", "Direct & clear (T)", "Gentle & considerate (F)")
        ]
        q_jp = [
            ("Your schedule style?", "Planned (J)", "Spontaneous (P)"),
            ("Before a deadlineโฆ", "Finish early (J)", "Rush at the end (P)"),
            ("Tidying up isโฆ", "Keep it neat (J)", "Only when needed (P)")
        ]

        ei = sn = tf = jp = 0

        st.subheader(t["sec_ei"])
        for i, (q, a, b) in enumerate(q_ei):
            if st.radio(q, [a, b], key=f"ei_{lang}_{i}") == a:
                ei += 1

        st.subheader(t["sec_sn"])
        for i, (q, a, b) in enumerate(q_sn):
            if st.radio(q, [a, b], key=f"sn_{lang}_{i}") == a:
                sn += 1

        st.subheader(t["sec_tf"])
        for i, (q, a, b) in enumerate(q_tf):
            if st.radio(q, [a, b], key=f"tf_{lang}_{i}") == a:
                tf += 1

        st.subheader(t["sec_jp"])
        for i, (q, a, b) in enumerate(q_jp):
            if st.radio(q, [a, b], key=f"jp_{lang}_{i}") == a:
                jp += 1

        if st.button(t["btn_view_test"], use_container_width=True):
            mbti = ""
            mbti += "E" if ei >= 2 else "I"
            mbti += "S" if sn >= 2 else "N"
            mbti += "T" if tf >= 2 else "F"
            mbti += "J" if jp >= 2 else "P"
            st.session_state.mbti = mbti
            st.session_state.result = True
            st.rerun()


# =========================================
# 6) ๊ฒฐ๊ณผ ํ๋ฉด
# =========================================
if st.session_state.result:
    y = st.session_state.birthdate.year
    m = st.session_state.birthdate.month
    d = st.session_state.birthdate.day
    name = st.session_state.name.strip()
    mbti = st.session_state.mbti

    zodiac = get_zodiac(y, lang)
    if zodiac is None:
        st.error(t["error_year"])
        if st.button(t["reset_btn"], use_container_width=True):
            st.session_state.result = False
            st.rerun()
        st.stop()

    mbti_desc = MBTIS.get(lang, MBTIS["en"]).get(mbti, mbti)
    saju = get_saju(y, m, d, lang)

    # DB ๋ก๋ (์ธ๋ถ JSON ์์ผ๋ฉด ์ฐ์ ์ฌ์ฉ)
    db, used_external = load_fortune_db(lang)

    rng = stable_rng(name, y, m, d, mbti, lang)

    # ์ค๋/๋ด์ผ์ ์นดํ๊ณ๋ฆฌ ๋๋ค(๊ฐ์ธํ seed ๊ธฐ๋ฐ)
    daily_categories = list(db["daily"].keys())
    cat_today = rng.choice(daily_categories)
    cat_tomorrow = rng.choice(daily_categories)

    today_msg = rng.choice(db["daily"][cat_today])
    tomorrow_msg = rng.choice(db["daily"][cat_tomorrow])

    overall = rng.choice(db["yearly"]["general"]) if "yearly" in db and "general" in db["yearly"] else rng.choice(db["daily"]["mindset"])
    combo_template = rng.choice(db["combo"]["zodiac_mbti"]) if "combo" in db and "zodiac_mbti" in db["combo"] else "{zodiac} + {mbti_desc}"
    combo_comment = combo_template.format(zodiac=zodiac, mbti=mbti, mbti_desc=mbti_desc)

    lucky_color = rng.choice(db["lucky"]["colors"]) if "lucky" in db and "colors" in db["lucky"] else "Gold"
    lucky_item = rng.choice(db["lucky"]["items"]) if "lucky" in db and "items" in db["lucky"] else "Notebook"
    tip = rng.choice(db["lucky"]["tips"]) if "lucky" in db and "tips" in db["lucky"] else rng.choice(db["daily"]["mindset"])

    name_display = (f"{name}" + ("๋์" if lang == "ko" else "")) if name else ""
    line_head = f"{name_display} {zodiac} ยท {mbti}" if name_display else f"{zodiac} ยท {mbti}"

    st.markdown(f"<div class='title'>{t['title']}</div>", unsafe_allow_html=True)
    st.markdown(f"<div class='bigline'>๐ฎ {line_head}</div>", unsafe_allow_html=True)
    st.markdown(f"<div class='subtitle'>{t['combo']}</div>", unsafe_allow_html=True)

    st.markdown(
        f"""
        <div class="card">
          <p><span class="kv">โจ {t['zodiac_title']}</span>: {zodiac}</p>
          <p><span class="kv">๐ง {t['mbti_title']}</span>: {mbti_desc} ({mbti})</p>
          <p><span class="kv">๐ {t['saju_title']}</span>: {saju}</p>
          <hr style="border:none;height:1px;background:rgba(120,100,180,0.18);margin:12px 0;">
          <p><span class="kv">๐ {t['today_title']}</span>: {today_msg}</p>
          <p><span class="kv">๐ {t['tomorrow_title']}</span>: {tomorrow_msg}</p>
          <hr style="border:none;height:1px;background:rgba(120,100,180,0.18);margin:12px 0;">
          <p><span class="kv">๐ {t['overall_title']}</span>: {overall}</p>
          <p><span class="kv">๐ฌ {t['combo_title']}</span>: {combo_comment}</p>
          <p><span class="kv">๐จ {t['lucky_color_title']}</span>: {lucky_color} &nbsp; | &nbsp;
             <span class="kv">๐งฟ {t['lucky_item_title']}</span>: {lucky_item}</p>
          <p><span class="kv">โ {t['tip_title']}</span>: {tip}</p>
        </div>
        """,
        unsafe_allow_html=True
    )

    # ํ๋ก
    with st.expander(t["tarot_btn"], expanded=False):
        tarot_rng = random.Random(abs(hash(f"tarot|{datetime.now().strftime('%Y%m%d')}|{name}|{mbti}|{lang}")) % (10**9))
        tarot_card = tarot_rng.choice(list(TAROT_CARDS.keys()))
        tarot_meaning = TAROT_CARDS[tarot_card].get(lang, TAROT_CARDS[tarot_card]["en"])
        st.markdown(
            f"""
            <div class="card" style="text-align:center;">
              <p style="font-weight:900; color:#7c3aed;">{t['tarot_title']}</p>
              <p style="font-size:22px; font-weight:900; margin-top:6px;">{tarot_card}</p>
              <p style="margin-top:8px;">{tarot_meaning}</p>
            </div>
            """,
            unsafe_allow_html=True
        )

    # ๊ณต์(ํ์คํธ๋ง): Web Share API โ ์คํจ ์ ์๋ ๋ณต์ฌ
    share_text = (
        f"{line_head}\n"
        f"{t['combo']}\n\n"
        f"{t['today_title']}: {today_msg}\n"
        f"{t['tomorrow_title']}: {tomorrow_msg}\n\n"
        f"{t['overall_title']}: {overall}\n"
        f"{t['combo_title']}: {combo_comment}\n"
        f"{t['lucky_color_title']}: {lucky_color} | {t['lucky_item_title']}: {lucky_item}\n"
        f"{t['tip_title']}: {tip}\n\n"
        f"{APP_URL}"
    )

    share_payload = json.dumps(share_text)
    share_title_payload = json.dumps(t["share_title"])
    fail_copy_payload = json.dumps(t["share_fail_copy"])
    manual_prompt_payload = json.dumps(t["share_manual_prompt"])
    cancel_payload = json.dumps(t["share_cancel"])

    components.html(
        f"""
        <div style="text-align:center; margin:22px 0 10px;">
          <button onclick="doShare()"
            style="background:#7c3aed; color:#ffffff; padding:16px 64px; border:none; border-radius:999px;
                   font-size:1.1em; font-weight:900; box-shadow: 0 8px 25px rgba(124,58,237,0.35);
                   cursor:pointer;">
            {t["share_btn"]}
          </button>
        </div>

        <script>
        async function doShare() {{
          const text = {share_payload};
          const title = {share_title_payload};

          try {{
            if (navigator.share) {{
              await navigator.share({{
                title: title,
                text: text
              }});
              return;
            }}

            if (navigator.clipboard && navigator.clipboard.writeText) {{
              await navigator.clipboard.writeText(text);
              alert({fail_copy_payload});
              return;
            }}

            prompt({manual_prompt_payload}, text);

          }} catch (e) {{
            alert({cancel_payload});
            try {{
              if (navigator.clipboard && navigator.clipboard.writeText) {{
                await navigator.clipboard.writeText(text);
              }}
            }} catch (_) {{}}
          }}
        }}
        </script>
        """,
        height=110
    )

    st.markdown(f"<div style='text-align:center; color:#6b6b6b; font-size:12px; margin-top:6px;'>{APP_URL}</div>", unsafe_allow_html=True)

    # ---- ์ด๋ณด์ฉ: DB JSON ๋ค์ด๋ก๋ (์ด๊ฑธ GitHub์ ์๋ก๋ํ๋ฉด ์ง์ง DB ๋ฐฉ์ ๋จ)
    with st.expander(t["db_tools_title"], expanded=False):
        st.write(t["db_tools_desc"])
        # ํ์ฌ ์ธ์ด์ DB๋ฅผ JSON์ผ๋ก ๋ค์ด๋ก๋
        db_json_bytes = json.dumps(db, ensure_ascii=False, indent=2).encode("utf-8")
        st.download_button(
            t["download_db_btn"],
            data=db_json_bytes,
            file_name=f"fortunes_{lang}.json",
            mime="application/json"
        )
        st.caption(t["db_path_hint"].format(lang=lang))
        st.caption(f"ํ์ฌ ์ํ: {'โ ์ธ๋ถ DB ์ฌ์ฉ ์ค' if used_external else 'โ๏ธ ํ์ผ์ด ์์ด์ ์ฑ์ด ์๋ ์์ฑ DB๋ฅผ ์ฌ์ฉ ์ค'}")

    if st.button(t["reset_btn"], use_container_width=True):
        st.session_state.result = False
        st.rerun()
